<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>KaiGPT - SAFI | Knowing.AI ‚Äî GEM Edition</title>
    <meta name="description" content="KaiGPT powered by SAFI ‚Äî First Egyptian AI assistant for the Grand Egyptian Museum opening. Know more. Do more." />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect width='64' height='64' fill='%23000000'/><circle cx='32' cy='32' r='22' fill='none' stroke='%23D4AF37' stroke-width='2.5'/></svg>">
    <style>
        :root{
            --black:#000000;
            --white:#ffffff;
            --surface-1:#050505;
            --surface-2:#0f0f0f;
            --muted:#bdbdbd;
            --gold:#d4af37;
            --accent:#ffffff;
            --glass: rgba(255,255,255,0.03);
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(180deg,var(--black),#050505);
            color:var(--white);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            overflow:hidden;
        }

        /* Layout */
        .app {
            display:flex;
            height:100vh;
            width:100%;
        }

        aside.sidebar{
            width:320px;
            background:linear-gradient(180deg,var(--surface-1),var(--surface-2));
            border-right:1px solid rgba(255,255,255,0.03);
            padding:28px 22px;
            display:flex;
            flex-direction:column;
            gap:18px;
        }

        .brand {
            display:flex;
            gap:14px;
            align-items:center;
        }
        .logo {
            width:72px;
            height:72px;
            border-radius:14px;
            background:var(--white);
            display:flex;
            align-items:center;
            justify-content:center;
            box-shadow: 0 6px 18px rgba(0,0,0,0.6);
        }
        .logo svg { width:56px; height:56px; }

        .brand-text {
            display:flex;
            flex-direction:column;
        }
        .brand-text .title {
            font-size:20px;
            font-weight:700;
            letter-spacing:0.2px;
            color:var(--white);
        }
        .brand-text .tag {
            font-size:12px;
            color:var(--muted);
        }
        .powered {
            font-size:11px;
            color:var(--muted);
            margin-top:4px;
        }

        .new-btn{
            margin-top:6px;
            width:100%;
            padding:12px 14px;
            background:var(--white);
            color:var(--black);
            border-radius:10px;
            font-weight:700;
            cursor:pointer;
            border:none;
            box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        }

        .card{
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius:12px;
            padding:14px;
            border:1px solid rgba(255,255,255,0.03);
        }

        .safi-line{ display:flex; gap:12px; align-items:center; }
        .avatar-s{ width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,#111,#222); display:flex; align-items:center; justify-content:center; font-size:20px; border:2px solid var(--gold); }
        .quick-actions{ display:flex; flex-direction:column; gap:8px; margin-top:8px; }
        .qa-item{ padding:10px; border-radius:10px; cursor:pointer; color:var(--muted); display:flex; gap:10px; align-items:center; }
        .qa-item:hover{ background: rgba(255,255,255,0.02); color:var(--white); }

        main.viewer{
            flex:1;
            display:flex;
            flex-direction:column;
            background:linear-gradient(180deg,var(--surface-2),#000);
        }

        header.topbar{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:20px 28px;
            border-bottom:1px solid rgba(255,255,255,0.03);
            background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
        }
        .title-main{ display:flex; gap:12px; align-items:center; }
        .title-main h1{ font-size:20px; margin:0; font-weight:700; letter-spacing:0.2px; }
        .gem-badge{ background:var(--white); color:var(--black); padding:6px 10px; border-radius:8px; font-weight:800; font-size:12px; }

        .controls{ display:flex; gap:10px; align-items:center; }

        .control-btn{
            padding:8px 12px; border-radius:10px; background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--white); cursor:pointer;
        }
        .control-btn.active{ background:var(--gold); color:var(--black); border-color:var(--gold); font-weight:700; }

        /* Messages area */
        .messages {
            flex:1;
            overflow:auto;
            padding:36px;
            display:flex;
            flex-direction:column;
            gap:20px;
        }

        .welcome {
            display:flex;
            flex-direction:column;
            align-items:center;
            gap:14px;
            text-align:center;
            margin-top:40px;
        }
        .hero-avatar{ width:160px; height:160px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:72px; border:6px solid var(--white); background:linear-gradient(135deg,#111,#222); box-shadow: 0 12px 40px rgba(0,0,0,0.6); }
        .welcome h2{ font-size:40px; margin:0; }
        .welcome p{ color:var(--muted); max-width:780px; line-height:1.6; }

        .starter { margin-top:12px; display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); width:100%; max-width:960px; }

        /* Message bubbles */
        .msg-row{ display:flex; gap:12px; align-items:flex-start; max-width:88%; }
        .msg-row.user{ margin-left:auto; flex-direction:row-reverse; }
        .msg-avatar{ width:44px; height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:700; }
        .bubble{
            padding:14px 16px; border-radius:14px; font-size:15px; line-height:1.6;
            box-shadow: 0 6px 20px rgba(0,0,0,0.6);
        }
        .bubble.assistant{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); color:var(--white); }
        .bubble.user{ background:var(--white); color:var(--black); border:1px solid rgba(0,0,0,0.04); }

        /* input */
        .composer{
            padding:20px 28px;
            border-top:1px solid rgba(255,255,255,0.03);
            background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
        }
        .input-wrap{ max-width:1100px; margin:0 auto; display:flex; gap:12px; align-items:flex-end; }
        .input-area{
            flex:1; background:var(--glass); border-radius:14px; padding:12px; border:1px solid rgba(255,255,255,0.03);
            display:flex; gap:8px; align-items:flex-end;
        }
        textarea#input{
            width:100%; min-height:44px; max-height:220px; resize:none; border:none; background:transparent; color:var(--white); font-size:15px; outline:none; padding:8px;
        }
        .actions{ display:flex; gap:8px; align-items:center; padding:8px; }
        .icon-btn{ width:44px; height:44px; border-radius:10px; border:none; cursor:pointer; background:transparent; color:var(--white); font-size:18px; display:flex; align-items:center; justify-content:center; }
        .send-btn{ width:52px; height:52px; border-radius:12px; background:var(--gold); color:var(--black); border:none; font-weight:800; cursor:pointer; }

        /* responsive */
        @media (max-width:1024px){
            aside.sidebar{ display:none; }
            .msg-row{ max-width:98%; }
            .welcome h2{ font-size:28px; }
        }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="brand">
                <div class="logo" aria-hidden="true">
                    <!-- gold-accent logo -->
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 72 L50 20 L84 72 Z" fill="none" stroke="#000" stroke-width="6"/>
                        <path d="M34 56 A16 16 0 1 0 66 56" fill="none" stroke="#d4af37" stroke-width="4"/>
                    </svg>
                </div>
                <div class="brand-text">
                    <div class="title">Knowing.AI</div>
                    <div class="tag">KaiGPT ‚Ä¢ SAFI ‚Äî GEM Edition</div>
                    <div class="powered">Powered by SAFI <span style="color:var(--gold); font-weight:800; margin-left:6px;">‚óè</span></div>
                </div>
            </div>

            <button class="new-btn" onclick="app.newConversation()">‚ûï New Conversation</button>

            <div class="card">
                <div class="safi-line">
                    <div class="avatar-s">üë∏</div>
                    <div>
                        <div style="font-weight:700;">SAFI</div>
                        <div style="font-size:12px;color:var(--muted)">First Egyptian AI assistant ‚Äî KaiGPT</div>
                    </div>
                </div>

                <div style="margin-top:12px; font-size:13px; color:var(--muted)">
                    Bilingual: ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ© & English<br>
                    Opening: 1 November 2025
                </div>
            </div>

            <div class="card">
                <div style="font-size:12px; color:var(--muted); font-weight:700; margin-bottom:8px;">Quick Prompts</div>
                <div class="quick-actions">
                    <div class="qa-item" onclick="app.sendPrompt('When will the Grand Egyptian Museum officially open?')">üèõ Opening date / ŸÖŸàÿπÿØ ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠</div>
                    <div class="qa-item" onclick="app.sendPrompt('Where is the GEM located?')">üìç Location / ÿßŸÑŸÖŸàŸÇÿπ</div>
                    <div class="qa-item" onclick="app.sendPrompt('What is special about the GEM collection?')">üóù Artifacts / ÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ©</div>
                    <div class="qa-item" onclick="app.sendPrompt('Tell me about the Grand Hall')">üåü Grand Hall / ÿßŸÑŸÇÿßÿπÿ© ÿßŸÑŸÉÿ®ÿ±Ÿâ</div>
                </div>
            </div>

            <div style="margin-top:auto; font-size:12px; color:var(--muted);">
                <div style="margin-bottom:8px;">KaiGPT ‚Ä¢ SAFI</div>
                <div>Knowing.AI ‚Äî Know more. Do more.</div>
            </div>
        </aside>

        <main class="viewer" role="main">
            <header class="topbar">
                <div class="title-main">
                    <h1>KaiGPT</h1>
                    <div class="gem-badge">GEM EDITION</div>
                </div>
                <div class="controls">
                    <button id="voiceToggle" class="control-btn" onclick="app.toggleVoice()">üé§ Voice</button>
                    <button class="control-btn" onclick="app.newConversation()">‚ü≤ Reset</button>
                </div>
            </header>

            <section class="messages" id="messages">
                <div class="welcome" id="welcome">
                    <div class="hero-avatar">üë∏</div>
                    <h2>ŸÖÿ±ÿ≠ÿ®ÿßŸã ‚Äî I'm SAFI</h2>
                    <p>First Egyptian AI assistant designed for the Grand Egyptian Museum opening. Ask me about the museum in Arabic or English ‚Äî SAFI will answer instantly.</p>

                    <div class="starter">
                        <div class="card" style="cursor:pointer" onclick="app.sendPrompt('When will the Grand Egyptian Museum officially open?')">When will the Grand Egyptian Museum officially open?</div>
                        <div class="card" style="cursor:pointer" onclick="app.sendPrompt('ÿ£ŸäŸÜ ŸäŸÇÿπ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿü')">ÿ£ŸäŸÜ ŸäŸÇÿπ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿü</div>
                        <div class="card" style="cursor:pointer" onclick="app.sendPrompt('Tell me about the Grand Hall')">Tell me about the Grand Hall</div>
                    </div>
                </div>
            </section>

            <footer class="composer">
                <div class="input-wrap">
                    <div class="input-area">
                        <textarea id="input" placeholder="Message SAFI in Arabic or English... (ŸÖÿ´ÿßŸÑ: ŸÖÿ™Ÿâ ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠ÿü / When is the opening?)" oninput="app.onInput()" onkeydown="app.onKey(event)"></textarea>
                        <div class="actions">
                            <button id="mic" class="icon-btn" onclick="app.toggleRecording()">üéô</button>
                            <button id="langBtn" class="icon-btn" onclick="app.toggleLanguage()">üåê</button>
                            <button id="send" class="send-btn" onclick="app.sendMessage()" title="Send">‚û§</button>
                        </div>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <script>
        // ===================== Knowledge base (your Q&A) =====================
        const KNOWLEDGE = [
            {
                id: 1,
                q_en: "When will the Grand Egyptian Museum officially open?",
                q_ar: "ŸÖÿ™Ÿâ ÿ≥ŸäŸÅÿ™ÿ™ÿ≠ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ÿ±ÿ≥ŸÖŸäÿßŸãÿü",
                a_en: "November 1, 2025.",
                a_ar: "1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025.",
                keywords: ["grand egyptian museum","opening date","official launch","opening","ŸÖŸàÿπÿØ ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠","ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±","ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠"]
            },
            {
                id: 2,
                q_en: "Where is the GEM located?",
                q_ar: "ÿ£ŸäŸÜ ŸäŸÇÿπ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿü",
                a_en: "One mile from the Giza Pyramids, Cairo, Egypt.",
                a_ar: "ÿπŸÑŸâ ÿ®ÿπÿØ ŸÖŸäŸÑ ŸÖŸÜ ÿ£Ÿáÿ±ÿßŸÖÿßÿ™ ÿßŸÑÿ¨Ÿäÿ≤ÿ©ÿå ÿßŸÑŸÇÿßŸáÿ±ÿ©ÿå ŸÖÿµÿ±.",
                keywords: ["location","giza","giza plateau","cairo","ÿßŸÑŸÖŸàŸÇÿπ","Ÿáÿ∂ÿ®ÿ© ÿßŸÑÿ¨Ÿäÿ≤ÿ©","ÿßŸÑŸÇÿßŸáÿ±ÿ©","ÿ£Ÿáÿ±ÿßŸÖÿßÿ™"]
            },
            {
                id: 3,
                q_en: "How large is the Grand Egyptian Museum?",
                q_ar: "ŸÉŸÖ ÿ™ÿ®ŸÑÿ∫ ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿü",
                a_en: "Approximately 480,000 square meters, the largest archaeological museum dedicated to a single civilization.",
                a_ar: "ÿ≠ŸàÿßŸÑŸä 480,000 ŸÖÿ™ÿ± ŸÖÿ±ÿ®ÿπÿå ÿ£ŸÉÿ®ÿ± ŸÖÿ™ÿ≠ŸÅ ÿ£ÿ´ÿ±Ÿä ŸÖÿÆÿµÿµ ŸÑÿ≠ÿ∂ÿßÿ±ÿ© Ÿàÿßÿ≠ÿØÿ©.",
                keywords: ["size","area","480000","ŸÖÿ≥ÿßÿ≠ÿ©","ÿ≠ÿ¨ŸÖ","ŸÖÿ™ÿ± ŸÖÿ±ÿ®ÿπ","ÿßŸÑŸÖÿ™ÿ≠ŸÅ"]
            },
            {
                id: 4,
                q_en: "What is special about the GEM‚Äôs collection?",
                q_ar: "ŸÖÿß ÿßŸÑÿ∞Ÿä Ÿäÿ¨ÿπŸÑ ŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ŸÖŸÖŸäÿ≤ÿ©ÿü",
                a_en: "It houses over 100,000 artifacts including the complete treasures of King Tutankhamun.",
                a_ar: "Ÿäÿ∂ŸÖ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ 100,000 ŸÇÿ∑ÿπÿ© ÿ£ÿ´ÿ±Ÿäÿ© ÿ®ŸÖÿß ŸÅŸä ÿ∞ŸÑŸÉ ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ŸÉÿßŸÖŸÑÿ©.",
                keywords: ["artifacts","tutankhamun","treasures","ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™","ÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ©","ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ"]
            },
            {
                id: 5,
                q_en: "Who designed the Grand Egyptian Museum building?",
                q_ar: "ŸÖŸÜ ÿµŸÖŸÖ ŸÖÿ®ŸÜŸâ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿü",
                a_en: "Designed by Heneghan Peng Architects, combining modern design with ancient Egyptian motifs.",
                a_ar: "ÿµŸÖŸÖŸá ŸÖŸÉÿ™ÿ® ŸáŸÜÿ∫ÿßŸÜ ÿ®ŸäŸÜÿ∫ ŸÑŸÑÿπŸÖÿßÿ±ÿ©ÿå Ÿäÿ¨ŸÖÿπ ÿ®ŸäŸÜ ÿßŸÑÿ™ÿµŸÖŸäŸÖ ÿßŸÑÿπÿµÿ±Ÿä ŸàÿßŸÑÿ≤ÿÆÿßÿ±ŸÅ ÿßŸÑŸÖÿµÿ±Ÿäÿ© ÿßŸÑŸÇÿØŸäŸÖÿ©.",
                keywords: ["heneghan","peng","architecture","design","ÿßŸÑŸáŸÜÿØÿ≥ÿ© ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ©","ÿ™ÿµŸÖŸäŸÖ","ŸáŸÜÿ∫ÿßŸÜ"]
            },
            {
                id: 6,
                q_en: "What is unique about the museum‚Äôs gates and logo?",
                q_ar: "ŸÖÿß ÿßŸÑÿ∞Ÿä ŸäŸÖŸäÿ≤ ÿ®Ÿàÿßÿ®ÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠ŸÅ Ÿàÿ¥ÿπÿßÿ±Ÿáÿü",
                a_en: "Gates are engraved with hieroglyphics symbolizing Egyptian culture; the logo blends a pyramid with the letter 'G' symbolizing heritage and modernity.",
                a_ar: "ÿßŸÑÿ®Ÿàÿßÿ®ÿßÿ™ ŸÖÿ≠ŸÅŸàÿ±ÿ© ÿ®ÿßŸÑŸáŸäÿ±Ÿàÿ∫ŸÑŸäŸÅŸäÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ±ŸÖÿ≤ ŸÑŸÑÿ´ŸÇÿßŸÅÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ©ÿå ŸàÿßŸÑÿ¥ÿπÿßÿ± Ÿäÿ¨ŸÖÿπ ÿ®ŸäŸÜ ÿßŸÑŸáÿ±ŸÖ Ÿàÿ≠ÿ±ŸÅ 'G' ŸÑŸäÿπÿ®ÿ± ÿπŸÜ ÿßŸÑÿ™ÿ±ÿßÿ´ ŸàÿßŸÑÿ≠ÿØÿßÿ´ÿ©.",
                keywords: ["gates","hieroglyphics","logo","ÿ®Ÿàÿßÿ®ÿßÿ™","ŸáŸäÿ±Ÿàÿ∫ŸÑŸäŸÅŸäÿ©","ÿ¥ÿπÿßÿ±"]
            },
            {
                id: 7,
                q_en: "How does GEM preserve and protect its artifacts?",
                q_ar: "ŸÉŸäŸÅ Ÿäÿ≠ÿßŸÅÿ∏ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿπŸÑŸâ ÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ© ŸàŸäÿ≠ŸÖŸäŸáÿßÿü",
                a_en: "Through advanced climate control, anti-seismic technology, specialized display cases, and security systems.",
                a_ar: "ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ÿ≠ŸÉŸÖ ŸÖŸÜÿßÿÆŸä ŸÖÿ™ŸÇÿØŸÖÿå ÿ™ÿµŸÖŸäŸÖ ŸÖŸÇÿßŸàŸÖ ŸÑŸÑÿ≤ŸÑÿßÿ≤ŸÑÿå ŸàÿπŸÑÿ® ÿπÿ±ÿ∂ ÿÆÿßÿµÿ©ÿå Ÿàÿ£ŸÜÿ∏ŸÖÿ© ÿ£ŸÖŸÜŸäÿ© ŸÖÿ™ÿ∑Ÿàÿ±ÿ©.",
                keywords: ["preservation","climate control","security","ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©","ÿ£ŸÖŸÜ","ÿ™ÿ±ŸÖŸäŸÖ"]
            },
            {
                id: 8,
                q_en: "What is the significance of the Grand Hall?",
                q_ar: "ŸÖÿß ŸáŸä ÿ£ŸáŸÖŸäÿ© ÿßŸÑŸÇÿßÿπÿ© ÿßŸÑŸÉÿ®ÿ±Ÿâÿü",
                a_en: "It features the colossal 83-ton statue of Ramses II and panoramic views of the pyramids.",
                a_ar: "ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ™ŸÖÿ´ÿßŸÑ ÿ∂ÿÆŸÖ ŸÑÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä Ÿäÿ≤ŸÜ 83 ÿ∑ŸÜŸãÿßÿå Ÿàÿ•ÿ∑ŸÑÿßŸÑÿßÿ™ ÿ®ÿßŸÜŸàÿ±ÿßŸÖŸäÿ© ÿπŸÑŸâ ÿßŸÑÿ£Ÿáÿ±ÿßŸÖÿßÿ™.",
                keywords: ["grand hall","ramses","ramesses","ÿ±ÿπŸÖÿ≥Ÿäÿ≥","ÿßŸÑŸÇÿßÿπÿ© ÿßŸÑŸÉÿ®ÿ±Ÿâ","ÿ™ŸÖÿ´ÿßŸÑ"]
            },
            {
                id: 9,
                q_en: "Are there interactive and digital exhibits?",
                q_ar: "ŸáŸÑ ÿ™Ÿàÿ¨ÿØ ŸÖÿπÿßÿ±ÿ∂ ÿ™ŸÅÿßÿπŸÑŸäÿ© Ÿàÿ±ŸÇŸÖŸäÿ©ÿü",
                a_en: "Yes, including VR presentations, holograms, and multi-language touchscreens.",
                a_ar: "ŸÜÿπŸÖÿå ÿ™ÿ¥ŸÖŸÑ ÿπÿ±Ÿàÿ∂ ÿßŸÑŸàÿßŸÇÿπ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿå ÿßŸÑŸáŸàŸÑŸàÿ¨ÿ±ÿßŸÖÿßÿ™ÿå Ÿàÿ¥ÿßÿ¥ÿßÿ™ ÿ®ÿßŸÑŸÑŸÖÿ≥ ŸÖÿ™ÿπÿØÿØÿ© ÿßŸÑŸÑÿ∫ÿßÿ™.",
                keywords: ["vr","virtual reality","hologram","interactive","ÿßŸÑŸàÿßŸÇÿπ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä","ŸáŸàŸÑŸàÿ¨ÿ±ÿßŸÖ","ÿ™ŸÅÿßÿπŸÑŸäÿ©"]
            },
            {
                id: 10,
                q_en: "What languages are supported for tours and guides?",
                q_ar: "ŸÖÿß ŸáŸä ÿßŸÑŸÑÿ∫ÿßÿ™ ÿßŸÑŸÖÿØÿπŸàŸÖÿ© ŸÑŸÑÿ¨ŸàŸÑÿßÿ™ ŸàÿßŸÑŸÖÿ¥ÿ±ŸÅŸäŸÜÿü",
                a_en: "Arabic, English, French, German, Spanish, Italian, Japanese, and Chinese.",
                a_ar: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©ÿå ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©ÿå ÿßŸÑŸÅÿ±ŸÜÿ≥Ÿäÿ©ÿå ÿßŸÑÿ£ŸÑŸÖÿßŸÜŸäÿ©ÿå ÿßŸÑÿ•ÿ≥ÿ®ÿßŸÜŸäÿ©ÿå ÿßŸÑÿ•Ÿäÿ∑ÿßŸÑŸäÿ©ÿå ÿßŸÑŸäÿßÿ®ÿßŸÜŸäÿ©ÿå ŸàÿßŸÑÿµŸäŸÜŸäÿ©.",
                keywords: ["languages","tours","guides","ÿßŸÑŸÑÿ∫ÿßÿ™","ÿ¨ŸàŸÑÿßÿ™"]
            },
            {
                id: 11,
                q_en: "How many artifacts does GEM hold?",
                q_ar: "ŸÉŸÖ ÿπÿØÿØ ÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ŸàŸäŸáÿß ÿßŸÑŸÖÿ™ÿ≠ŸÅÿü",
                a_en: "Over 57,000 artifacts including more than 5,000 pieces from King Tutankhamun‚Äôs treasures displayed together for the first time.",
                a_ar: "Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ 57 ÿ£ŸÑŸÅ ŸÇÿ∑ÿπÿ© ÿ£ÿ´ÿ±Ÿäÿ©ÿå ŸÖŸÜŸáÿß ÿ£ŸÉÿ´ÿ± ŸÖŸÜ 5 ÿ¢ŸÑÿßŸÅ ŸÇÿ∑ÿπÿ© ŸÖŸÜ ŸÉŸÜŸàÿ≤ ÿßŸÑŸÖŸÑŸÉ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ÿ™Ÿèÿπÿ±ÿ∂ ŸÖÿ¨ÿ™ŸÖÿπÿ© ŸÑÿ£ŸàŸÑ ŸÖÿ±ÿ©.",
                keywords: ["57000","57,000","artifacts count","pieces","ÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ©","Ÿ•ŸßŸ†Ÿ†Ÿ†","ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™"]
            },
            {
                id: 12,
                q_en: "What technologies does GEM use for exhibits?",
                q_ar: "ŸÖÿß ŸáŸä ÿßŸÑÿ™ŸÇŸÜŸäÿßÿ™ ÿßŸÑÿ™Ÿä Ÿäÿ≥ÿ™ÿÆÿØŸÖŸáÿß ÿßŸÑŸÖÿ™ÿ≠ŸÅ ŸÅŸä ÿßŸÑŸÖÿπÿßÿ±ÿ∂ÿü",
                a_en: "Uses advanced digital and interactive display technologies, VR, and applications for an educational and entertaining visitor experience.",
                a_ar: "Ÿäÿπÿ™ŸÖÿØ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿπŸÑŸâ ÿ£ÿ≠ÿØÿ´ ÿ™ŸÇŸÜŸäÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ±ŸÇŸÖŸä ŸàÿßŸÑÿ™ŸÅÿßÿπŸÑŸä ŸàÿßŸÑŸàÿßŸÇÿπ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÑÿ™ŸÇÿØŸäŸÖ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© Ÿàÿ™ÿ±ŸÅŸäŸáŸäÿ©.",
                keywords: ["technology","tech","digital","exhibits tech","ÿ™ŸÇŸÜŸäÿßÿ™","ÿßŸÑŸàÿßŸÇÿπ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä"]
            },
            {
                id: 13,
                q_en: "What is the significance of the Children‚Äôs Museum at GEM?",
                q_ar: "ŸÖÿß ŸáŸä ÿ£ŸáŸÖŸäÿ© ŸÖÿ™ÿ≠ŸÅ ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ ŸÅŸä ÿßŸÑŸÖÿ™ÿ≠ŸÅÿü",
                a_en: "It spans 5,000 sqm and provides interactive learning areas and educational apps to introduce children to ancient Egyptian civilization.",
                a_ar: "ŸäŸÖÿ™ÿØ ÿπŸÑŸâ ŸÖÿ≥ÿßÿ≠ÿ© 5000 ŸÖÿ™ÿ± ŸÖÿ±ÿ®ÿπ ŸàŸäÿ∂ŸÖ ŸÖŸÜÿßÿ∑ŸÇ ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© Ÿàÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™ ÿ™ÿπŸÑŸäŸÖŸäÿ© ŸÑÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ ÿ®ÿßŸÑÿ≠ÿ∂ÿßÿ±ÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ© ÿßŸÑŸÇÿØŸäŸÖÿ©.",
                keywords: ["children","children's museum","5000","ŸÖÿ™ÿ≠ŸÅ ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ","ÿ™ÿπŸÑŸäŸÖ"]
            },
            {
                id: 14,
                q_en: "How many visitors is GEM expected to attract annually?",
                q_ar: "ŸÉŸÖ ÿπÿØÿØ ÿßŸÑÿ≤Ÿàÿßÿ± ÿßŸÑŸÖÿ™ŸàŸÇÿπ ŸÑŸÑŸÖÿ™ÿ≠ŸÅ ÿ≥ŸÜŸàŸäŸãÿßÿü",
                a_en: "Around five million visitors per year.",
                a_ar: "ŸÖŸÜ ÿßŸÑŸÖÿ™ŸàŸÇÿπ ÿ£ŸÜ Ÿäÿ≥ÿ™ŸÇÿ∑ÿ® ŸÜÿ≠Ÿà ÿÆŸÖÿ≥ÿ© ŸÖŸÑÿßŸäŸäŸÜ ÿ≤ÿßÿ¶ÿ± ÿ≥ŸÜŸàŸäŸãÿß.",
                keywords: ["visitors","annual attendance","five million","5,000,000","ÿßŸÑÿ≤Ÿàÿßÿ±","ÿßŸÑÿ≥Ÿäÿßÿ≠ÿ©"]
            },
            {
                id: 15,
                q_en: "What was the timeline for GEM‚Äôs construction and development?",
                q_ar: "ŸÖÿß ŸáŸà ÿ¨ÿØŸàŸÑ ÿ®ŸÜÿßÿ° Ÿàÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÖÿ™ÿ≠ŸÅÿü",
                a_en: "Groundbreaking in 2002, construction began 2005, with completion of the main building in 2021 and opening in 2025.",
                a_ar: "ÿ®ÿØÿ£ Ÿàÿ∂ÿπ ÿ≠ÿ¨ÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥ ÿπÿßŸÖ 2002ÿå ŸàÿßŸÑÿ•ŸÜÿ¥ÿßÿ° ÿπÿßŸÖ 2005ÿå ÿ™ŸÖ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ° ŸÖŸÜ ÿßŸÑŸÖÿ®ŸÜŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ÿπÿßŸÖ 2021ÿå ŸàÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠ ÿπÿßŸÖ 2025.",
                keywords: ["timeline","construction","2002","2005","2021","ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿ≤ŸÖŸÜŸä","ÿßŸÑÿ®ŸÜÿßÿ°"]
            },
            {
                id: 16,
                q_en: "How does GEM support Egyptian tourism?",
                q_ar: "ŸÉŸäŸÅ ŸäÿØÿπŸÖ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑÿ≥Ÿäÿßÿ≠ÿ© ŸÅŸä ŸÖÿµÿ±ÿü",
                a_en: "It is a national project aimed at attracting millions of tourists annually and elevating Egypt‚Äôs cultural image globally.",
                a_ar: "ŸÖÿ¥ÿ±Ÿàÿπ ŸÇŸàŸÖŸä ŸäŸáÿØŸÅ ŸÑÿ¨ÿ∞ÿ® ŸÖŸÑÿßŸäŸäŸÜ ÿßŸÑÿ≥Ÿäÿßÿ≠ ÿ≥ŸÜŸàŸäÿßŸã Ÿàÿ™ÿπÿ≤Ÿäÿ≤ ÿµŸàÿ±ÿ© ŸÖÿµÿ± ÿßŸÑÿ´ŸÇÿßŸÅŸäÿ© ÿπÿßŸÑŸÖŸäÿßŸã.",
                keywords: ["tourism support","cultural image","tourism","ÿßŸÑÿ≥Ÿäÿßÿ≠ÿ©","ÿµŸàÿ±ÿ© ŸÖÿµÿ±"]
            },
            {
                id: 17,
                q_en: "What are the main functional components inside GEM?",
                q_ar: "ŸÖÿß ŸáŸä ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑŸàÿ∏ŸäŸÅŸäÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿ™ÿ≠ŸÅÿü",
                a_en: "Exhibition halls, restoration center, educational zones, cinema, conference center, commercial areas, and gardens.",
                a_ar: "ŸÇÿßÿπÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ÿå ŸÖÿ±ŸÉÿ≤ ÿ™ÿ±ŸÖŸäŸÖ ÿßŸÑÿ¢ÿ´ÿßÿ±ÿå ŸÖŸÜÿßÿ∑ŸÇ ÿ™ÿπŸÑŸäŸÖŸäÿ©ÿå ÿ≥ŸäŸÜŸÖÿßÿå ŸÖÿ±ŸÉÿ≤ ŸÖÿ§ÿ™ŸÖÿ±ÿßÿ™ÿå ŸÖŸÜÿßÿ∑ŸÇ ÿ™ÿ¨ÿßÿ±Ÿäÿ© Ÿàÿ≠ÿØÿßÿ¶ŸÇ.",
                keywords: ["facilities","restoration","education","cinema","ŸÖÿ±ŸÉÿ≤ ÿ™ÿ±ŸÖŸäŸÖ","ŸÖÿ±ÿßŸÅŸÇ"]
            },
            {
                id: 18,
                q_en: "What notable artifacts are prominently displayed?",
                q_ar: "ŸÖÿß ŸáŸä ÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ© ÿßŸÑŸÑÿßŸÅÿ™ÿ© ÿßŸÑŸÖÿπÿ±Ÿàÿ∂ÿ©ÿü",
                a_en: "Besides Tutankhamun‚Äôs treasures, statues of Ramses II and Queen Hetepheres, King Khufu‚Äôs boats, and artifacts from Pre-Dynastic to Roman times.",
                a_ar: "ÿ®ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜÿå ÿ™ŸÖÿßÿ´ŸäŸÑ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä Ÿàÿ≠ÿ™ÿ® ÿ≠ÿ±ÿ≥ÿå ŸÖÿ±ÿßŸÉÿ® ÿÆŸàŸÅŸà ŸàŸÇÿ∑ÿπ ŸÖŸÜ ÿßŸÑÿπÿµÿ± ŸÇÿ®ŸÑ ÿßŸÑÿ£ÿ≥ÿ±ÿßÿ™ ÿ≠ÿ™Ÿâ ÿßŸÑÿπÿµÿ± ÿßŸÑÿ±ŸàŸÖÿßŸÜŸä.",
                keywords: ["ramses","khufu","boats","hetep","notable artifacts","ÿ™ŸÖÿßÿ´ŸäŸÑ","ŸÖÿ±ÿßŸÉÿ® ÿÆŸàŸÅŸà"]
            },
            {
                id: 19,
                q_en: "How was the winning design for GEM chosen?",
                q_ar: "ŸÉŸäŸÅ ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿ™ÿµŸÖŸäŸÖ ÿßŸÑŸÖÿ™ÿ≠ŸÅÿü",
                a_en: "Through an international architectural competition held by UNESCO and international architects aiming to blend sunlight and pyramid symbolism.",
                a_ar: "ÿπÿ®ÿ± ŸÖÿ≥ÿßÿ®ŸÇÿ© ŸÖÿπŸÖÿßÿ±Ÿäÿ© ÿØŸàŸÑŸäÿ© ÿ®ÿ±ÿπÿßŸäÿ© ÿßŸÑŸäŸàŸÜÿ≥ŸÉŸà ŸÑÿ™ÿ≠ŸÇŸäŸÇ ÿØŸÖÿ¨ ÿ£ÿ¥ÿπÿ© ÿßŸÑÿ¥ŸÖÿ≥ Ÿàÿ±ŸÖÿ≤ ÿßŸÑŸáÿ±ŸÖ ŸÅŸä ÿßŸÑÿ™ÿµŸÖŸäŸÖ.",
                keywords: ["competition","unesco","design selection","ŸÖÿ≥ÿßÿ®ŸÇÿ©","ÿßŸÑŸäŸàŸÜÿ≥ŸÉŸà"]
            },
            {
                id: 20,
                q_en: "What cultural and entertainment services exist at GEM?",
                q_ar: "ŸÖÿß ŸáŸä ÿßŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ´ŸÇÿßŸÅŸäÿ© ŸàÿßŸÑÿ™ÿ±ŸÅŸäŸáŸäÿ© ŸÅŸä ÿßŸÑŸÖÿ™ÿ≠ŸÅÿü",
                a_en: "Cultural activities, temporary exhibitions, events, restaurants, cafes, and retail stores representing Egyptian heritage.",
                a_ar: "ÿ£ŸÜÿ¥ÿ∑ÿ© ÿ´ŸÇÿßŸÅŸäÿ©ÿå ŸÖÿπÿßÿ±ÿ∂ ŸÖÿ§ŸÇÿ™ÿ©ÿå ŸÅÿπÿßŸÑŸäÿßÿ™ÿå ŸÖÿ∑ÿßÿπŸÖÿå ŸÖŸÇÿßŸáŸä ŸàŸÖÿ™ÿßÿ¨ÿ± ÿ™ÿπŸÉÿ≥ ÿßŸÑÿ™ÿ±ÿßÿ´ ÿßŸÑŸÖÿµÿ±Ÿä.",
                keywords: ["events","restaurants","cafes","cultural services","ŸÅÿπÿßŸÑŸäÿßÿ™","ŸÖÿ∑ÿßÿπŸÖ"]
            }
        ];

        // ===================== Helper utilities =====================
        function isArabic(text){
            return /[\u0600-\u06FF]/.test(text);
        }

        function normalizeText(s){
            return (s||'').toLowerCase().replace(/[^\w\u0600-\u06FF\s]+/g,' ').replace(/\s+/g,' ').trim();
        }

        function findBestMatch(userText){
            const norm = normalizeText(userText);
            if(!norm) return null;

            // score KB entries by keyword matches (simple)
            const scores = KNOWLEDGE.map(item => {
                let score = 0;
                const textToCheck = norm;
                for(const kw of item.keywords){
                    const nkw = normalizeText(kw);
                    // exact word match or substring
                    if(nkw && (textToCheck.includes(nkw) || textToCheck.split(' ').includes(nkw))) score += 1;
                }
                return {item, score};
            });

            // pick highest score > 0
            scores.sort((a,b)=> b.score - a.score);
            if(scores.length && scores[0].score > 0){
                return scores[0].item;
            }

            // fallback: try simple semantic checks by checking key nouns
            for(const item of KNOWLEDGE){
                // if the user's text includes a key noun from question itself
                const qCombine = normalizeText(item.q_en + ' ' + item.q_ar);
                const qWords = qCombine.split(' ').filter(Boolean);
                let found = 0;
                for(const w of qWords){
                    if(w.length>3 && norm.includes(w)) found++;
                }
                if(found >= 2) return item;
            }

            return null;
        }

        // ===================== App logic =====================
        const app = {
            isVoice: false,
            recognition: null,
            isRecording:false,
            init(){
                this.messagesEl = document.getElementById('messages');
                this.inputEl = document.getElementById('input');
                this.sendBtn = document.getElementById('send');
                this.voiceBtn = document.getElementById('voiceToggle');
                this.micBtn = document.getElementById('mic');

                // show welcome already in DOM
                this.setupSpeech();
                this.setupEventListeners();
            },

            setupEventListeners(){
                this.inputEl.addEventListener('input', ()=> {
                    this.sendBtn.disabled = !this.inputEl.value.trim();
                });
            },

            setupSpeech(){
                if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
                    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SR();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.onresult = (e) => {
                        const t = e.results[0][0].transcript;
                        this.inputEl.value = t;
                        this.sendBtn.disabled = false;
                        this.isRecording = false;
                        this.micBtn.classList.remove('active');
                    };
                    this.recognition.onerror = ()=> {
                        this.isRecording = false;
                        this.micBtn.classList.remove('active');
                    };
                }
            },

            toggleVoice(){
                this.isVoice = !this.isVoice;
                this.voiceBtn.classList.toggle('active', this.isVoice);
            },

            toggleRecording(){
                if(!this.recognition){
                    alert("Speech recognition not supported in this browser.");
                    return;
                }
                if(this.isRecording){
                    this.recognition.stop();
                    this.isRecording=false;
                    this.micBtn.classList.remove('active');
                } else {
                    // set language from current recognized input content if arabic detected else default ar-EG
                    this.recognition.lang = isArabic(this.inputEl.value || '') ? 'ar-EG' : 'ar-EG';
                    this.recognition.start();
                    this.isRecording=true;
                    this.micBtn.classList.add('active');
                }
            },

            onInput(){
                // auto-grow
                const el = this.inputEl;
                el.style.height = 'auto';
                el.style.height = Math.min(el.scrollHeight, 220) + 'px';
            },

            onKey(e){
                if(e.key === 'Enter' && !e.shiftKey){
                    e.preventDefault();
                    this.sendMessage();
                }
            },

            newConversation(){
                // clear messages and show welcome
                this.messagesEl.innerHTML = document.getElementById('welcome').outerHTML;
                window.scrollTo(0,0);
            },

            sendPrompt(text){
                this.inputEl.value = text;
                this.sendBtn.disabled = false;
                this.sendMessage();
            },

            async sendMessage(){
                const text = this.inputEl.value.trim();
                if(!text) return;
                // remove welcome if exists
                const welcomeNode = document.getElementById('welcome');
                if(welcomeNode) welcomeNode.remove();

                // show user bubble
                this.addMessage(text, 'user');
                this.inputEl.value = '';
                this.onInput();
                this.sendBtn.disabled = true;

                // show typing indicator
                const typingId = this.showTyping();

                // compute best match
                const match = findBestMatch(text);
                await this.sleep(700); // small delay to seem natural

                // remove typing
                this.removeTyping(typingId);

                if(match){
                    const langIsArabic = isArabic(text);
                    const answer = langIsArabic ? match.a_ar : match.a_en;
                    this.addMessage(answer, 'assistant');
                    // speak if voice enabled
                    if(this.isVoice) this.speak(answer, langIsArabic ? 'ar-EG' : 'en-US');
                } else {
                    // default fallback (bilingual)
                    const fallbackAr = "ÿπÿ∞ÿ±ÿßŸãÿå ÿßŸÑŸÖÿπŸÑŸàŸÖÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ© ÿ≠ÿßŸÑŸäÿßŸã. ÿ≠ÿßŸàŸÑ ÿµŸäÿßÿ∫ÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ£ÿÆÿ±Ÿâ ÿ£Ÿà ÿßÿÆÿ™ÿ± ÿ£ÿ≠ÿØ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©.";
                    const fallbackEn = "Sorry, that information isn't available right now. Try rephrasing or choose a quick prompt.";
                    const reply = isArabic(text) ? fallbackAr : fallbackEn;
                    this.addMessage(reply, 'assistant');
                    if(this.isVoice) this.speak(reply, isArabic(text)?'ar-EG':'en-US');
                }

                // keep scroll at bottom
                this.messagesEl.scrollTop = this.messagesEl.scrollHeight;
            },

            addMessage(content, role){
                const row = document.createElement('div');
                row.className = 'msg-row ' + (role === 'user' ? 'user' : '');
                const avatar = document.createElement('div');
                avatar.className = 'msg-avatar';
                avatar.style.background = role === 'user' ? 'var(--white)' : 'linear-gradient(135deg,#111,#222)';
                avatar.style.color = role === 'user'? 'var(--black)' : 'var(--gold)';
                avatar.textContent = role === 'user' ? 'You' : 'üë∏';
                const bubble = document.createElement('div');
                bubble.className = 'bubble ' + (role === 'user' ? 'user' : 'assistant');
                // allow simple paragraphs and line breaks
                bubble.innerHTML = sanitizeHTML(content);
                row.appendChild(avatar);
                row.appendChild(bubble);
                this.messagesEl.appendChild(row);
                // scroll
                this.messagesEl.scrollTop = this.messagesEl.scrollHeight;
            },

            showTyping(){
                const row = document.createElement('div');
                row.className = 'msg-row';
                row.id = 'typing-indicator';
                const avatar = document.createElement('div');
                avatar.className = 'msg-avatar';
                avatar.textContent = 'üë∏';
                avatar.style.background = 'linear-gradient(135deg,#111,#222)';
                avatar.style.color = 'var(--gold)';
                const bubble = document.createElement('div');
                bubble.className = 'bubble assistant';
                bubble.innerHTML = '<span style="opacity:0.85">Typing<span style="opacity:0.6">...</span></span>';
                row.appendChild(avatar);
                row.appendChild(bubble);
                this.messagesEl.appendChild(row);
                this.messagesEl.scrollTop = this.messagesEl.scrollHeight;
                return row;
            },

            removeTyping(node){
                if(node && node.remove) node.remove();
                const el = document.getElementById('typing-indicator');
                if(el) el.remove();
            },

            removeTypingById(id){
                const el = document.getElementById(id);
                if(el) el.remove();
            },

            sleep(ms){ return new Promise(r=>setTimeout(r, ms)); },

            speak(text, lang){
                if(!('speechSynthesis' in window)) return;
                window.speechSynthesis.cancel();
                const ut = new SpeechSynthesisUtterance(text);
                ut.lang = lang || 'ar-EG';
                ut.rate = 0.95;
                ut.pitch = 1.02;
                const vlist = window.speechSynthesis.getVoices();
                if(lang && lang.startsWith('ar')){
                    const v = vlist.find(x => x.lang && x.lang.startsWith('ar')) || vlist[0];
                    if(v) ut.voice = v;
                } else {
                    const v = vlist.find(x => x.lang && x.lang.startsWith('en')) || vlist[0];
                    if(v) ut.voice = v;
                }
                window.speechSynthesis.speak(ut);
            },

            toggleLanguage(){
                // small helper to insert sample bilingual phrase
                const sample = isArabic(this.inputEl.value || '') ? "Tell me about the Grand Hall" : "ÿ£ÿÆÿ®ÿ±ŸÜŸä ÿπŸÜ ÿßŸÑŸÇÿßÿπÿ© ÿßŸÑŸÉÿ®ÿ±Ÿâ";
                this.inputEl.value = sample;
                this.sendBtn.disabled = false;
            }
        };

        function sanitizeHTML(str){
            // simple sanitize: escape < >
            return String(str).replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
        }

        // expose small helpers
        window.app = app;

        document.addEventListener('DOMContentLoaded', ()=> {
            app.init();
            console.log('KaiGPT ‚Ä¢ SAFI ‚Äî Local demo (rule-based) ready.');
        });
    </script>
</body>
</html>
