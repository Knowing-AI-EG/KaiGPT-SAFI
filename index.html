<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KaiGPT â€¢ SAFI â€” Knowing.AI (GEM Opening Edition)</title>
<meta name="description" content="KaiGPT powered by SAFI â€” Egypt's First AI Guide for the Grand Egyptian Museum. The world's largest archaeological museum opens November 1, 2025!"/>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%23000000'/%3E%3Ccircle cx='32' cy='32' r='22' fill='none' stroke='%23ffffff' stroke-width='2.5'/%3E%3C/svg%3E">
<style>
  /* --- 1. ROOT VARIABLES (DARK MODE - AMAZING BLACK) --- */
  :root{
    --bg: #000000; 
    --panel: #0a0a0a; 
    --muted: #999999; 
    --text: #ffffff; 
    --accent: #ffffff; 
    --secondary-accent: #e0e0e0; /* New: a lighter white for contrast */
    --gold: #ffffff; 
    --egyptian-blue: #0f0f0f; 
    --glass: rgba(255,255,255,0.05); 
    --shadow: rgba(255,255,255,0.05); 
    --radius:12px;
    --max-width:980px;
  }
  
  /* --- 2. LIGHT MODE (AMAZING WHITE) --- */
  body.light-mode {
    --bg: #ffffff; 
    --panel: #f0f0f0; 
    --muted: #666666; 
    --text: #000000; 
    --accent: #000000; 
    --secondary-accent: #333333; 
    --gold: #000000; 
    --egyptian-blue: #eeeeee; 
    --glass: rgba(0,0,0,0.05); 
    --shadow: rgba(0,0,0,0.1); 
    background: linear-gradient(180deg,var(--bg),#fcfcfc);
  }

  /* --- 3. BASE STYLES --- */
  *{box-sizing:border-box}
  html,body{
    height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, "Cairo", system-ui, -apple-system;
    background:linear-gradient(180deg,var(--bg),#050505);
    color:var(--text);-webkit-font-smoothing:antialiased;
    transition: background 0.5s, color 0.5s;
  }
  a{color:var(--secondary-accent);text-decoration:none}

  /* Enhanced animations */
  @keyframes glow {
    0%, 100% { box-shadow: 0 0 10px var(--shadow); }
    50% { box-shadow: 0 0 20px var(--shadow); }
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  @keyframes slideIn {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  /* --- 4. LAYOUT --- */
  .root{display:flex;min-height:100vh;padding:18px;gap:18px}
  .sidebar{
    width:340px;background:linear-gradient(180deg,var(--panel),var(--bg));border-radius:var(--radius);
    padding:20px;display:flex;flex-direction:column;gap:16px;border:1px solid var(--glass);
    box-shadow:0 8px 30px rgba(0,0,0,0.8);
    transition: background 0.5s, border-color 0.5s;
  }

  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:72px;height:72px;border-radius:12px;background:var(--egyptian-blue);
    display:flex;align-items:center;justify-content:center;border:2px solid var(--glass); 
    font-weight:800;color:var(--accent); font-size:18px;
    position:relative;overflow:hidden;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  
  .brand h1{margin:0;font-size:19px;background:linear-gradient(135deg, var(--accent), var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  .brand .sub{color:var(--muted);font-size:13px;margin-top:2px}

  .slogan{font-weight:700;color:var(--accent);margin-top:8px;font-size:15px}
  .powered{color:var(--muted);font-size:12px;margin-top:12px}

  .countdown{
    background:linear-gradient(135deg, var(--egyptian-blue), var(--panel));
    padding:16px;border-radius:12px;text-align:center;margin:12px 0;
    border:1px solid var(--glass);
    animation:glow 2s ease-in-out infinite;
  }
  .countdown-text{font-weight:800;color:var(--text);font-size:14px;margin-bottom:8px}
  .countdown-time{font-size:20px;font-weight:900;color:var(--accent);text-shadow:0 0 8px var(--shadow)}

  .stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0}
  .stat{background:var(--glass);padding:12px;border-radius:8px;text-align:center;border:1px solid var(--glass)}
  .stat-number{font-size:18px;font-weight:800;color:var(--accent)}
  .stat-label{font-size:11px;color:var(--muted);margin-top:4px}

  /* Quick buttons section */
  .quick button{background:transparent;border:1px solid var(--glass);color:var(--muted);padding:12px;border-radius:10px;text-align:right;cursor:pointer;transition:all 0.3s ease}
  .quick button:hover{color:var(--text);background:var(--glass);border-color:var(--accent);transform:translateX(-3px)}

  .sidebar .footer{margin-top:auto;color:var(--muted);font-size:12px;text-align:center;padding:12px 0;border-top:1px solid var(--glass)}

  /* --- 5. MAIN CONTENT --- */
  .main{flex:1;display:flex;flex-direction:column;gap:12px}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:6px 12px}
  .title{font-size:22px;font-weight:800;background:linear-gradient(135deg, var(--accent), var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  .tag{background:var(--glass);padding:8px 12px;border-radius:10px;color:var(--accent);font-weight:700;border:1px solid var(--glass)}

  .container{flex:1;display:flex;gap:18px;align-items:stretch}
  .chat-column{flex:1;max-width:var(--max-width);margin:0 auto;display:flex;flex-direction:column;border-radius:var(--radius);overflow:hidden;border:1px solid var(--glass);background:linear-gradient(180deg,rgba(0,0,0,0.01),transparent)}
  .messages{flex:1;padding:28px;overflow:auto;display:flex;flex-direction:column;gap:18px;min-height:420px}
  
  .welcome{display:flex;gap:16px;align-items:flex-start;padding:18px;border-radius:12px;background:linear-gradient(180deg, var(--glass), transparent);animation:slideIn 0.6s ease-out}
  .avatar{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;background:var(--egyptian-blue);border:3px solid var(--glass);position:relative}
  .avatar::after{content:'';position:absolute;inset:-3px;border-radius:50%;background:conic-gradient(var(--accent), var(--secondary-accent), var(--accent));z-index:-1;animation:spin 4s linear infinite}
  
  .welcome-text h2{margin:0 0 8px 0;font-size:24px;background:linear-gradient(135deg, var(--accent), var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  .welcome-text p{margin:0;color:var(--muted);line-height:1.6;max-width:720px}
  .welcome-text p:last-of-type{padding:12px;background:var(--glass);border-radius:8px;border:1px solid var(--glass)}
  .welcome-text strong{color:var(--accent)}

  .msg{display:flex;gap:12px;align-items:flex-start;animation:slideIn 0.4s ease-out}
  .msg.user{flex-direction:row-reverse;justify-content:flex-end}
  .bubble{padding:16px 18px;border-radius:12px;max-width:78%;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;position:relative;box-shadow: 0 4px 12px rgba(0,0,0,0.2)}
  .msg.user .bubble{background:linear-gradient(180deg, var(--glass), rgba(255,255,255,0.02));color:var(--text);border:1px solid var(--glass)}
  .msg.bot .bubble{background:linear-gradient(180deg, var(--panel), var(--bg));color:var(--text);border:1px solid var(--glass)}
  .bubble .title-small{font-weight:700;color:var(--accent);font-size:14px;margin-bottom:8px;display:flex;align-items:center;gap:8px}
  .bubble .title-small::before{content:'ğŸ‘¸ğŸ»';font-size:16px}
  
  /* Styling for the new kids' stories popup */
  .story-menu {
      background: var(--panel);
      padding: 18px;
      border-radius: 12px;
      margin-top: 12px;
      border: 1px solid var(--glass);
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
  }
  .story-menu-title {
      font-weight: 800;
      color: var(--accent);
      font-size: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
  }
  .story-menu button {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--glass);
      color: var(--text);
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      text-align: right;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
  .story-menu button:hover {
      background: var(--glass);
      border-color: var(--accent);
  }

  .composer{padding:18px;border-top:1px solid var(--glass);background:linear-gradient(180deg, rgba(255,255,255,0.005), transparent)}
  .composer-inner{display:flex;gap:12px;align-items:flex-end;max-width:var(--max-width);margin:0 auto}
  textarea.input{flex:1;min-height:56px;max-height:260px;resize:none;border-radius:12px;padding:16px;background:var(--panel);border:1px solid var(--glass);color:var(--text);font-size:16px;outline:none;font-family:inherit;transition:border-color 0.3s ease}
  textarea.input:focus{border-color:var(--accent);box-shadow:0 0 0 2px var(--shadow)}
  
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:transparent;border:1px solid var(--glass);color:var(--text);padding:12px 14px;border-radius:10px;cursor:pointer;transition:all 0.3s ease}
  .btn:hover{background:var(--glass);border-color:var(--accent)}
  .btn.primary{
    background:linear-gradient(90deg,var(--accent),var(--secondary-accent));
    color:var(--bg); 
    border:1px solid var(--accent);font-weight:800;
    box-shadow:0 8px 20px var(--shadow);transform:scale(1)
  }
  .btn.primary:hover{transform:scale(1.05);box-shadow:0 12px 30px var(--shadow);border-color:var(--secondary-accent)}

  .small-note{color:var(--muted);font-size:13px;text-align:center;margin-top:10px}

  .right-col{width:340px;display:flex;flex-direction:column;gap:12px}
  .card{background:linear-gradient(180deg, var(--glass), transparent);padding:16px;border-radius:12px;border:1px solid var(--glass);color:var(--muted)}
  .card h3{margin:0 0 10px 0;color:var(--text);font-size:16px}

  .live-info{background:linear-gradient(135deg, var(--bg), var(--panel));border:2px solid var(--accent);animation:glow 3s ease-in-out infinite}
  .live-badge{display:inline-flex;align-items:center;gap:6px;background:var(--accent);color:var(--bg);padding:4px 8px;border-radius:6px;font-size:11px;font-weight:800;margin-bottom:8px}
  .live-dot{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:pulse 1s infinite}

  /* --- 6. MEDIA QUERIES --- */
  @media (max-width:1100px){
    .root{padding:12px;flex-direction:column}
    .sidebar{width:100%;order:2}
    .right-col{width:100%;order:3}
    .chat-column{max-width:100%;order:1}
    .container{flex-direction:column}
    .msg.user{flex-direction:row}
    .bubble{max-width:90%}
  }

  /* Typing indicator */
  .typing-dots{display:inline-flex;gap:4px;align-items:center}
  .typing-dot{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:typing 1.4s infinite}
  .typing-dot:nth-child(2){animation-delay:0.2s}
  .typing-dot:nth-child(3){animation-delay:0.4s}
  @keyframes typing {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-10px); }
  }

  footer.app-footer{
    width:100%; text-align:center; padding:16px 0; color:var(--muted); font-size:12px;
    background:transparent; border-top:1px solid var(--glass)
  }
</style>
</head>
<body class="dark-mode">
  <div class="root" role="application" aria-label="KaiGPT â€¢ SAFI">
    <aside class="sidebar" aria-label="Sidebar">
      <div>
        <div class="brand">
          <div class="logo" aria-hidden="true">KAI</div>
          <div>
            <h1>Knowing.AI</h1>
            <div class="sub">KaiGPT â€¢ SAFI â€” GEM Opening Edition</div>
          </div>
        </div>

        <div class="slogan" id="slogan">â€œKnow more. Do more.â€</div>

        <div class="countdown">
          <div class="countdown-text" id="countdown-text">ğŸ›ï¸ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±</div>
          <div class="countdown-time" id="countdown">OPENING DAY!</div>
          <div style="font-size:12px;color:var(--text);margin-top:4px">1 November 2025</div>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="stat-number" id="stat-1">100K+</div>
            <div class="stat-label" id="label-1">Ù‚Ø·Ø¹Ø© Ø£Ø«Ø±ÙŠØ©</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="stat-2">5000+</div>
            <div class="stat-label" id="label-2">ÙƒÙ†ÙˆØ² ØªÙˆØª</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="stat-3">480K</div>
            <div class="stat-label" id="label-3">Ù…Â² Ù…Ø³Ø§Ø­Ø©</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="stat-4">5M</div>
            <div class="stat-label" id="label-4">Ø²Ø§Ø¦Ø± Ø³Ù†ÙˆÙŠØ§Ù‹</div>
          </div>
        </div>

        <div style="margin-top:14px;">
          <div class="card" style="margin-bottom:12px">
            <strong style="color:var(--text)">SAFI â€” Ø§Ù„Ù…Ø±Ø´Ø¯Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</strong>
            <div style="margin-top:8px;color:var(--muted);font-size:13px" id="safi-desc">
              ØµØ§ÙÙŠ -Ø£ÙˆÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØµØ±ÙŠ ÙˆØ´Ø®ØµÙŠØ© ÙˆÙ…Ø¤Ø«Ø±Ø©ØŒ ÙˆØ£ÙˆÙ„ Ù…Ø±Ø´Ø¯Ø© Ø°ÙƒÙŠØ© ØªØªØ­Ø¯Ø« Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ø£ØµÙŠÙ„Ø© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ø·Ù„Ø§Ù‚Ø©ØŒ ÙˆØªØªÙ…ØªØ¹ Ø¨Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±.
            </div>
          </div>

          <div class="card" style="margin-bottom:12px">
            <button class="btn primary" style="width:100%; color: var(--bg); font-size:16px;" onclick="app.showKidsMenu()">
              ğŸ‘¶ğŸ» ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø·ÙØ§Ù„ - Ø§Ù„Ù‚ØµØµ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
            </button>
          </div>

          <div class="card">
            <div style="font-weight:700;margin-bottom:8px;color:var(--text)" id="quick-title">ğŸ¯ Ø£Ø³Ø¦Ù„Ø© Ø³Ø±ÙŠØ¹Ø©</div>
            <div style="display:flex;flex-direction:column;gap:8px" id="quick-prompts">
              <button class="btn" onclick="app.sendPrompt('Ù…ØªÙ‰ Ø§ÙØªØªØ§Ø­ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±ØŸ')">ğŸ›ï¸ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§ÙØªØªØ§Ø­</button>
              <button class="btn" onclick="app.sendPrompt('What makes GEM the world\'s largest museum?')">ğŸŒ Ø§Ù„Ø£ÙƒØ¨Ø± Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹</button>
              <button class="btn" onclick="app.sendPrompt('Ø£ÙŠÙ‡ Ø£Ù‡Ù… ÙƒÙ†ÙˆØ² ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ† ÙÙŠ Ø§Ù„Ù…ØªØ­ÙØŸ')">ğŸ‘‘ ÙƒÙ†ÙˆØ² ØªÙˆØª</button>
              <button class="btn" onclick="app.sendPrompt('Tell me about SAFI and Knowing.AI')">ğŸ¤– Ø¹Ù† ØµØ§ÙÙŠ</button>
              <button class="btn" onclick="app.sendPrompt('Ø£Ø³Ø¹Ø§Ø± ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…ØªØ­Ù Ø£ÙŠÙ‡ØŸ')">ğŸ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ°Ø§ÙƒØ±</button>
              <button class="btn" onclick="app.sendPrompt('How can I visit GEM from Cairo?')">ğŸš— Ø¥Ø²Ø§ÙŠ Ø£Ø±ÙˆØ­</button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer" id="footer">
        Â© 2025 Knowing.AI â€” Egypt's First Unified AI Platform â€¢ Powered by SAFI
        <div id="developer-note">Developer: Knowing.AI - KaiGPT</div>
      </div>
    </aside>

    <main class="main" role="main">
      <div class="topbar">
        <div class="title" id="main-title">KaiGPT <span class="tag" style="margin-left:12px">ğŸ›ï¸ GEM OPENING</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" onclick="app.toggleTheme()" title="ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©">ğŸ”†</button>
          <button class="btn" onclick="app.toggleLanguage()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©">ğŸŒ</button>
          <button class="btn" onclick="app.reset()" id="reset-btn">ğŸ”„ Reset</button>
          <button id="voiceBtn" class="btn" onclick="app.toggleVoice()">ğŸ¤ Voice</button>
          <button class="btn" onclick="app.showInfo()">â„¹ï¸ Info</button>
        </div>
      </div>

      <div class="container">
        <section class="chat-column" aria-label="Chat Column">
          <div class="messages" id="messages" role="log" aria-live="polite">
            <div class="welcome" id="welcome">
              <div class="avatar" aria-hidden="true">ğŸ‘¸ğŸ»</div>
              <div class="welcome-text">
                <h2 id="welcome-title">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ! Ø£Ù†Ø§ ØµØ§ÙÙŠ ğŸ‡ªğŸ‡¬</h2>
                <p id="welcome-text-1">Ø£Ù†Ø§ ØµØ§ÙÙŠØŒ Ø£ÙˆÙ„ Ù…Ø±Ø´Ø¯Ø© Ø°ÙƒÙŠØ© Ù…ØµØ±ÙŠØ© Ù…Ù† Knowing.AIØŒ ÙˆØ£Ù†Ø§ Ù‡Ù†Ø§ Ø¹Ø´Ø§Ù† Ø£Ø³Ø§Ø¹Ø¯Ùƒ ØªØ¹Ø±Ù ÙƒÙ„ Ø­Ø§Ø¬Ø© Ø¹Ù† Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± Ø§Ù„Ù„ÙŠ Ù‡ÙŠÙØªØ­ Ø¨ÙƒØ±Ø© 1 Ù†ÙˆÙÙ…Ø¨Ø± 2025! Ø¥Ø³Ø£Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ Ø£Ùˆ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØŒ ÙˆÙ‡Ø¬Ø§ÙˆØ¨Ùƒ Ø¨ÙƒÙ„ Ø­Ø¨ ÙˆÙØ®Ø± Ø¨ØªØ§Ø±ÙŠØ®Ù†Ø§ Ø§Ù„Ø¹Ø¸ÙŠÙ…. ğŸ›ï¸âœ¨</p>
                <p style="margin-top:12px;" id="welcome-text-2">
                  <strong id="news-strong">ğŸ‰ Ø®Ø¨Ø± Ø¹Ø§Ø¬Ù„:</strong> Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±ØŒ Ø£ÙƒØ¨Ø± Ù…ØªØ­Ù Ø£Ø«Ø±ÙŠ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŒ ÙŠÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨Ù‡ Ø±Ø³Ù…ÙŠØ§Ù‹ Ø¨ÙƒØ±Ø© ÙÙŠ Ø­ÙÙ„ Ø¹Ø§Ù„Ù…ÙŠ Ù…Ù‡ÙŠØ¨!
                </p>
              </div>
            </div>
          </div>

          <div class="composer" aria-label="Composer">
            <div class="composer-inner">
              <textarea id="input" class="input" placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ø¹Ù† Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±... ğŸ›ï¸ (Ù…Ø«Ø§Ù„: Ù…ØªÙ‰ Ø§Ù„Ø§ÙØªØªØ§Ø­ØŸ Ø£Ùˆ What time does GEM open?)" oninput="app.onInput()" onkeydown="app.onKey(event)"></textarea>
              <div class="controls">
                <button id="mic" class="btn" onclick="app.toggleRecording()" title="ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ">ğŸ™ï¸</button>
                <button class="btn primary" onclick="app.send()" id="send-btn">â¤ Ø¥Ø±Ø³Ø§Ù„</button>
              </div>
            </div>
            <div class="small-note" id="small-note">â€œKnow more. Do more.â€</div>
          </div>
        </section>

        <aside class="right-col" aria-hidden="true">
          <div class="card live-info">
            <div class="live-badge">
              <div class="live-dot"></div>
              LIVE UPDATE
            </div>
            <h3 id="live-info-title">ğŸ›ï¸ Ø§ÙØªØªØ§Ø­ ØªØ§Ø±ÙŠØ®ÙŠ</h3>
            <p id="live-info-text">Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± ÙŠÙØªØ­ ØºØ¯Ø§Ù‹ 1 Ù†ÙˆÙÙ…Ø¨Ø± 2025 ÙÙŠ Ø­ÙÙ„ ÙŠØ´Ù‡Ø¯Ù‡ Ø§Ù„Ø¹Ø§Ù„Ù… ÙƒÙ„Ù‡! ğŸŒ</p>
            <ul style="margin:8px 0;padding:0 0 0 20px;color:var(--text)" id="live-info-list">
              <li>Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ TikTok</li>
              <li>Ø­Ø¶ÙˆØ± Ù‚Ø§Ø¯Ø© ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ù…Ù† Ø§Ù„Ø¹Ø§Ù„Ù…</li>
              <li>Ø§ÙØªØªØ§Ø­ Ù…Ø¹Ø§Ø±Ø¶ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ†</li>
            </ul>
          </div>

          <div class="card">
            <h3 id="facts-title">ğŸ“Š Ø­Ù‚Ø§Ø¦Ù‚ Ù…Ø°Ù‡Ù„Ø©</h3>
            <ul style="margin:8px 0 0 18px;color:var(--muted);padding:0;" id="facts-list">
              <li><strong id="fact-1-strong">Ø£ÙƒØ«Ø± Ù…Ù† Ù¡Ù Ù ,Ù Ù Ù </strong> Ù‚Ø·Ø¹Ø© Ø£Ø«Ø±ÙŠØ©</li>
              <li><strong id="fact-2-strong">Ø£ÙƒØ«Ø± Ù…Ù† Ù¥,Ù Ù Ù </strong> Ù‚Ø·Ø¹Ø© Ù…Ù† ÙƒÙ†ÙˆØ² ØªÙˆØª</li>
              <li><strong id="fact-3-strong">Ù¤Ù¨Ù ,Ù Ù Ù  Ù…Â²</strong> Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ø±Ø¶</li>
              <li><strong id="fact-4-strong">â‚¬30</strong> Ø³Ø¹Ø± Ø§Ù„ØªØ°ÙƒØ±Ø© Ù„Ù„Ø£Ø¬Ø§Ù†Ø¨</li>
              <li><strong id="fact-5-strong">Ø£ÙƒØ«Ø± Ù…Ù† Ù¥ Ù…Ù„ÙŠÙˆÙ†</strong> Ø²Ø§Ø¦Ø± Ù…ØªÙˆÙ‚Ø¹ Ø³Ù†ÙˆÙŠØ§Ù‹</li>
            </ul>
          </div>

          <div class="card">
            <h3 id="about-kai-title">ğŸ¯ About Knowing.AI</h3>
            <p id="about-kai-text">Ù…Ù†ØµØ© Ù…ØµØ±ÙŠØ© Ø±Ø§Ø¦Ø¯Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ ØªÙ‚Ø¯Ù… Ø­Ù„ÙˆÙ„ Ù…Ø¨ØªÙƒØ±Ø© Ù„Ù„Ø³ÙŠØ§Ø­Ø© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ.</p>
            <div style="margin-top:12px;font-size:12px;color:var(--secondary-accent)">
              <strong id="developer-label">Developer:</strong> Knowing.AI - KaiGPT
            </div>
          </div>
        </aside>
      </div>

      <footer class="app-footer" id="app-footer-2">
        ğŸ‡ªğŸ‡¬ Made with Love in Egypt â€¢ Â© 2025 Knowing.AI â€” Egypt's First Unified AI Platform â€¢ Powered by SAFI
      </footer>

    </main>
  </div>

<script>
/* ========================= COMPREHENSIVE KNOWLEDGE BASE ========================= */
const ENHANCED_KNOWLEDGE = [
  // Opening & Basic Info
  { 
    id: 1, 
    keywords: ["Ù…ØªÙ‰","Ø§ÙØªØªØ§Ø­","opening","when","november","1 november","1 Ù†ÙˆÙÙ…Ø¨Ø±","Ù…ÙˆØ¹Ø¯","ØªØ§Ø±ÙŠØ®","date"], 
    a_ar: "ğŸ‰ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± ÙŠÙØªØ­ Ø±Ø³Ù…ÙŠØ§Ù‹ ØºØ¯Ø§Ù‹ 1 Ù†ÙˆÙÙ…Ø¨Ø± 2025 ÙÙŠ Ø­ÙÙ„ Ø¹Ø§Ù„Ù…ÙŠ Ù…Ù‡ÙŠØ¨! Ø§Ù„Ø­ÙÙ„ Ù‡ÙŠØ¨Ù‚Ù‰ live Ø¹Ù„Ù‰ TikTok ÙˆØ§Ù„Ø¹Ø§Ù„Ù… ÙƒÙ„Ù‡ Ù‡ÙŠØ´ÙˆÙ Ø£Ø¹Ø¸Ù… Ø§ÙØªØªØ§Ø­ Ù…ØªØ­Ù ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®.", 
    a_en: "ğŸ‰ The Grand Egyptian Museum (GEM) officially opens tomorrow, November 1, 2025, in a magnificent global ceremony! The event will be live-streamed for the world to witness the greatest museum opening in history." 
  },
  
  // Location & Access
  { 
    id: 2, 
    keywords: ["Ø§ÙŠÙ†","Ø£ÙŠÙ†","Ù…ÙƒØ§Ù†","where","location","giza","Ø§Ù„Ø¬ÙŠØ²Ø©","Ø§Ù‡Ø±Ø§Ù…Ø§Øª","pyramids","Ø¹Ù†ÙˆØ§Ù†","address"], 
    a_ar: "ğŸ›ï¸ Ø§Ù„Ù…ØªØ­Ù Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‡Ø¶Ø¨Ø© Ø§Ù„Ø¬ÙŠØ²Ø©ØŒ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¯ Ù…Ø¦Ø§Øª Ø§Ù„Ø£Ù…ØªØ§Ø± Ù…Ù† Ø£Ù‡Ø±Ø§Ù…Ø§Øª Ø§Ù„Ø¬ÙŠØ²Ø© Ø§Ù„Ø¹Ø¸ÙŠÙ…Ø©. Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø«Ø§Ù„ÙŠ ÙˆÙŠØ·Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‡Ø±Ø§Ù…Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©!", 
    a_en: "ğŸ›ï¸ The GEM is located on the Giza plateau, just a few hundred meters from the iconic Pyramids of Giza. The location is perfect with direct views of the pyramids!" 
  },

  // Tutankhamun Collection
  { 
    id: 4, 
    keywords: ["ØªÙˆØª","ØªÙˆØª Ø¹Ù†Ø®","tutankhamun","treasures","ÙƒÙ†ÙˆØ²","mask","Ù‚Ù†Ø§Ø¹","5000","Ø®Ù…Ø³Ø© Ø¢Ù„Ø§Ù"], 
    a_ar: "ğŸ‘‘ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ ÙƒÙ„ ÙƒÙ†ÙˆØ² Ø§Ù„Ù…Ù„Ùƒ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ† Ø§Ù„Ù€Ù¥Ù Ù Ù  Ù‚Ø·Ø¹Ø© Ù‡ØªØ¨Ù‚Ù‰ Ù…Ø¹Ø±ÙˆØ¶Ø© ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯! Ø´Ø§Ù…Ù„ Ø§Ù„Ù‚Ù†Ø§Ø¹ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ø´Ù‡ÙŠØ± ÙˆØ§Ù„ØªÙ…Ø§Ø«ÙŠÙ„ Ø§Ù„Ø®Ø´Ø¨ÙŠØ© Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ.", 
    a_en: "ğŸ‘‘ For the first time in history, all 5,000+ treasures of King Tutankhamun will be displayed in one place at the GEM! This includes the famous golden funeral mask and life-size wooden statues." 
  },

  // Ramses II Story (KIDS)
  {
    id: 21,
    keywords: ["Ù‚ØµØ© Ø±Ù…Ø³ÙŠØ³","ramses story","Ø±Ù…Ø³ÙŠØ³ Ø§Ù„Ø«Ø§Ù†ÙŠ","ØªÙ…Ø«Ø§Ù„","Ø¨Ø·Ù„ Ø§Ù„Ù‚ÙˆØ©"],
    a_ar: "ğŸ‘‘ **Ù‚ØµØ© Ø§Ù„Ù…Ù„Ùƒ Ø±Ù…Ø³ÙŠØ³ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø¨Ø·Ù„ Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¹Ø¯Ù„:** ØªØ®ÙŠÙ„ ÙŠØ§ Ø¨Ø·Ù„ Ø£Ù† Ø±Ù…Ø³ÙŠØ³ ØªÙˆÙ„Ù‰ Ø§Ù„Ø­ÙƒÙ… ÙˆÙ‡Ùˆ Ø´Ø§Ø¨ Ù‚ÙˆÙŠ ÙˆØ´Ø¬Ø§Ø¹. Ø­Ø§Ø±Ø¨ ÙˆØ§Ù†ØªØµØ± (ÙÙŠ Ù‚Ø§Ø¯Ø´)ØŒ ÙˆØ¨Ù†Ù‰ Ù…Ø¹Ø§Ø¨Ø¯ Ø¶Ø®Ù…Ø© (Ø£Ø¨Ùˆ Ø³Ù…Ø¨Ù„) ØªØ¨Ø±Ø² Ù‚ÙˆØªÙ‡ ÙˆØ¹Ø¯Ù„Ù‡. Ø§Ù„Ø¹Ø¨Ø±Ø© Ù‡ÙŠ: **Ø¨Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¥Ø±Ø§Ø¯Ø© ÙˆØ§Ù„Ø­ÙƒÙ…Ø©ØŒ ØªØµØ¨Ø­ Ù‚Ø§Ø¦Ø¯Ø§Ù‹ Ø¹Ø¸ÙŠÙ…Ø§Ù‹ ÙˆÙŠØ®Ù„Ø¯ Ø§Ø³Ù…Ùƒ!**",
    a_en: "ğŸ‘‘ **The Story of King Ramses II - Hero of Strength and Justice:** Imagine, young hero, Ramses became king when he was young, strong, and brave. He fought and won battles (like Kadesh), and built massive temples (Abu Simbel) showing his strength and justice. The moral is: **With strength, willpower, and wisdom, you become a great leader and immortalize your name!**"
  },

  // Queen Hatshepsut Story (KIDS)
  {
    id: 22,
    keywords: ["Ù‚ØµØ© Ø­ØªØ´Ø¨Ø³ÙˆØª","hatshepsut story","Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ù‚Ù„","Ù…Ù„ÙƒØ© Ø§Ù„Ø¬Ù…Ø§Ù„","queen"],
    a_ar: "ğŸ‘¸ğŸ» **Ù‚ØµØ© Ø§Ù„Ù…Ù„ÙƒØ© Ø­ØªØ´Ø¨Ø³ÙˆØª - Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ù‚Ù„ ÙˆØ§Ù„Ø¬Ù…Ø§Ù„:** ÙƒØ§Ù†Øª Ø­ØªØ´Ø¨Ø³ÙˆØª Ø°ÙƒÙŠØ© Ø¬Ø¯Ø§Ù‹ ÙˆØ¬Ù…ÙŠÙ„Ø©ØŒ Ø­ÙƒÙ…Øª Ù…ØµØ± Ø¨Ù‚ÙˆØ© Ø§Ù„Ø¹Ù‚Ù„ ÙˆÙ„ÙŠØ³ Ø§Ù„Ø³ÙŠÙ! Ø¨Ù†Øª Ù…Ø¹Ø¨Ø¯ Ø§Ù„Ø¯ÙŠØ± Ø§Ù„Ø¨Ø­Ø±ÙŠ ÙˆØ£Ø±Ø³Ù„Øª Ø±Ø­Ù„Ø§Øª ØªØ¬Ø§Ø±ÙŠØ© Ø¶Ø®Ù…Ø©. Ø§Ù„Ø¹Ø¨Ø±Ø© Ù‡ÙŠ: **ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªÙƒÙˆÙ†ÙŠ Ù‚ÙˆÙŠØ© ÙˆÙ…Ø¤Ø«Ø±Ø© Ø¨Ø°ÙƒØ§Ø¦Ùƒ ÙˆØ¬Ù…Ø§Ù„Ùƒ ÙˆØ­ÙƒÙ…ØªÙƒØŒ ÙØ§Ù„Ø¹Ù‚Ù„ Ù‚ÙˆØ©!**",
    a_en: "ğŸ‘¸ğŸ» **The Story of Queen Hatshepsut - Queen of Mind and Beauty:** Hatshepsut was very intelligent and beautiful. She ruled Egypt with the power of the mind, not the sword! She built the magnificent Deir el-Bahari Temple and sent huge trade expeditions. The moral is: **You can be strong and influential with your intelligence, beauty, and wisdom, for the mind is power!**"
  },

  // Tutankhamun Mask Story (KIDS)
  {
    id: 23,
    keywords: ["Ø³Ø± Ù‚Ù†Ø§Ø¹ ØªÙˆØª","golden mask","Ù‚Ù†Ø§Ø¹ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ†","Ø°Ù‡Ø¨"],
    a_ar: "âœ¨ **Ø³Ø± Ù‚Ù†Ø§Ø¹ Ø§Ù„Ù…Ù„Ùƒ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ† Ø§Ù„Ø°Ù‡Ø¨ÙŠ:** Ù‡Ø°Ø§ Ø§Ù„Ù‚Ù†Ø§Ø¹ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ù„Ø§ ÙŠÙ‚Ø¯Ø± Ø¨Ø«Ù…Ù† Ù„Ø£Ù†Ù‡ Ù…ØµÙ†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ø®Ø§Ù„Øµ ÙˆØ§Ù„Ø£Ø­Ø¬Ø§Ø± Ø§Ù„ÙƒØ±ÙŠÙ…Ø©. Ù„Ù… ÙŠÙƒÙ† Ù…Ø¬Ø±Ø¯ Ù‚Ù†Ø§Ø¹ØŒ Ø¨Ù„ ÙƒØ§Ù† Ø±Ù…Ø²Ø§Ù‹ Ù„ÙŠØµØ¨Ø­ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ† Ø¥Ù„Ù‡Ø§Ù‹ Ø¨Ø¹Ø¯ Ù…ÙˆØªÙ‡ØŒ ÙŠØ¹Ø¨Ø± Ø¹Ù† Ø§Ø¹ØªÙ‚Ø§Ø¯ Ø§Ù„Ù…ØµØ±ÙŠÙŠÙ† Ø¨Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø£Ø¨Ø¯ÙŠØ©! Ø§Ù„Ø¹Ø¨Ø±Ø©: **ØªØ§Ø±ÙŠØ®Ù†Ø§ ÙƒÙ†Ø² Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø§Ø± ÙˆØ§Ù„Ù‚ÙŠÙ… Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† Ù†Ø­Ø§ÙØ¸ Ø¹Ù„ÙŠÙ‡Ø§!**",
    a_en: "âœ¨ **The Secret of Tutankhamun's Golden Mask:** This priceless mask is made of pure gold and gemstones. It wasn't just a mask; it was a symbol for Tutankhamun to become a god after death, representing the Egyptians' belief in eternal life! The moral: **Our history is a treasure of secrets and values we must preserve!**"
  },
];

/* ========================= LOCALIZED CONTENT DATA ========================= */
const CONTENT = {
    ar: {
        // UI Text
        slogan: "Ø§Ø¹Ø±Ù Ø§ÙƒØªØ±. Ø§ÙØ¹Ù„ Ø§ÙƒØªØ±.",
        countdownText: "ğŸ›ï¸ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±",
        quickTitle: "ğŸ¯ Ø£Ø³Ø¦Ù„Ø© Ø³Ø±ÙŠØ¹Ø©",
        sendBtn: "â¤ Ø¥Ø±Ø³Ø§Ù„",
        smallNote: "Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø£ÙˆÙ„ ØªØ¬Ø±Ø¨Ø© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØµØ±ÙŠØ© Ø£ØµÙŠÙ„Ø© â€¢ Ø§Ø¹Ø±Ù Ø§ÙƒØªØ±. Ø§ÙØ¹Ù„ Ø§ÙƒØªØ±.",
        typing: "ØµØ§ÙÙŠ Ø¨ØªÙƒØªØ¨",
        resetBtn: "ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†",
        liveInfoTitle: "ğŸ›ï¸ Ø§ÙØªØªØ§Ø­ ØªØ§Ø±ÙŠØ®ÙŠ",
        liveInfoText: "Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± ÙŠÙØªØ­ ØºØ¯Ø§Ù‹ 1 Ù†ÙˆÙÙ…Ø¨Ø± 2025 ÙÙŠ Ø­ÙÙ„ ÙŠØ´Ù‡Ø¯Ù‡ Ø§Ù„Ø¹Ø§Ù„Ù… ÙƒÙ„Ù‡! ğŸŒ",
        factsTitle: "ğŸ“Š Ø­Ù‚Ø§Ø¦Ù‚ Ù…Ø°Ù‡Ù„Ø©",
        aboutKaiTitle: "ğŸ¯ Ø¹Ù† Knowing.AI",
        aboutKaiText: "Ù…Ù†ØµØ© Ù…ØµØ±ÙŠØ© Ø±Ø§Ø¦Ø¯Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ ØªÙ‚Ø¯Ù… Ø­Ù„ÙˆÙ„ Ù…Ø¨ØªÙƒØ±Ø© Ù„Ù„Ø³ÙŠØ§Ø­Ø© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ.",
        developerLabel: "Ø§Ù„Ù…Ø·ÙˆØ±:",
        developerNote: "Ø§Ù„Ù…Ø·ÙˆØ±: Knowing.AI - KaiGPT",
        footer: "Â© 2025 Knowing.AI â€” Egypt's First Unified AI Platform â€¢ Powered by SAFI",
        footer2: "ğŸ‡ªğŸ‡¬ ØµÙ†Ø¹ Ø¨ÙƒÙ„ Ø­Ø¨ ÙÙŠ Ù…ØµØ± â€¢ Â© 2025 Knowing.AI â€” Ø£ÙˆÙ„ Ù…Ù†ØµØ© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ÙˆØ­Ø¯Ø© ÙÙŠ Ù…ØµØ± â€¢ Ù…Ø¯Ø¹ÙˆÙ… Ù…Ù† SAFI",

        // Stats
        stats: [
            { num: "Ø£ÙƒØ«Ø± Ù…Ù† Ù¡Ù Ù  Ø£Ù„Ù", label: "Ù‚Ø·Ø¹Ø© Ø£Ø«Ø±ÙŠØ©" },
            { num: "Ø£ÙƒØ«Ø± Ù…Ù† Ù¥Ù Ù Ù ", label: "ÙƒÙ†ÙˆØ² Ø§Ù„Ù…Ù„Ùƒ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ†" },
            { num: "Ù¤Ù¨Ù  Ø£Ù„Ù", label: "Ù…ØªØ± Ù…Ø±Ø¨Ø¹" },
            { num: "Ø£ÙƒØ«Ø± Ù…Ù† Ù¥ Ù…Ù„ÙŠÙˆÙ†", label: "Ø²Ø§Ø¦Ø± Ø³Ù†ÙˆÙŠØ§Ù‹" }
        ],
        
        // Welcome & SAFI
        welcomeTitle: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ! Ø£Ù†Ø§ ØµØ§ÙÙŠ ğŸ‡ªğŸ‡¬",
        welcomeText1: "Ø£Ù†Ø§ ØµØ§ÙÙŠØŒ Ø£ÙˆÙ„ Ù…Ø±Ø´Ø¯Ø© Ø°ÙƒÙŠØ© Ù…ØµØ±ÙŠØ© Ù…Ù† Knowing.AIØŒ ÙˆØ£Ù†Ø§ Ù‡Ù†Ø§ Ø¹Ø´Ø§Ù† Ø£Ø³Ø§Ø¹Ø¯Ùƒ ØªØ¹Ø±Ù ÙƒÙ„ Ø­Ø§Ø¬Ø© Ø¹Ù† Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± Ø§Ù„Ù„ÙŠ Ù‡ÙŠÙØªØ­ Ø¨ÙƒØ±Ø© 1 Ù†ÙˆÙÙ…Ø¨Ø± 2025! Ø¥Ø³Ø£Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ Ø£Ùˆ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØŒ ÙˆÙ‡Ø¬Ø§ÙˆØ¨Ùƒ Ø¨ÙƒÙ„ Ø­Ø¨ ÙˆÙØ®Ø± Ø¨ØªØ§Ø±ÙŠØ®Ù†Ø§ Ø§Ù„Ø¹Ø¸ÙŠÙ…. ğŸ›ï¸âœ¨",
        newsStrong: "ğŸ‰ Ø®Ø¨Ø± Ø¹Ø§Ø¬Ù„:",
        welcomeText2: "Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±ØŒ Ø£ÙƒØ¨Ø± Ù…ØªØ­Ù Ø£Ø«Ø±ÙŠ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŒ ÙŠÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨Ù‡ Ø±Ø³Ù…ÙŠØ§Ù‹ Ø¨ÙƒØ±Ø© ÙÙŠ Ø­ÙÙ„ Ø¹Ø§Ù„Ù…ÙŠ Ù…Ù‡ÙŠØ¨!",
        safiDesc: "ØµØ§ÙÙŠ -Ø£ÙˆÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØµØ±ÙŠ ÙˆØ´Ø®ØµÙŠØ© ÙˆÙ…Ø¤Ø«Ø±Ø©ØŒ ÙˆØ£ÙˆÙ„ Ù…Ø±Ø´Ø¯Ø© Ø°ÙƒÙŠØ© ØªØªØ­Ø¯Ø« Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ø£ØµÙŠÙ„Ø© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ø·Ù„Ø§Ù‚Ø©ØŒ ÙˆØªØªÙ…ØªØ¹ Ø¨Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±.",

        // Prompts & Kids
        quickPrompts: [
            { text: "ğŸ›ï¸ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§ÙØªØªØ§Ø­", prompt: "Ù…ØªÙ‰ Ø§ÙØªØªØ§Ø­ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±ØŸ" },
            { text: "ğŸŒ Ø§Ù„Ø£ÙƒØ¨Ø± Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹", prompt: "Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± Ø§Ù„Ø£ÙƒØ¨Ø± Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ØŸ" },
            { text: "ğŸ‘‘ ÙƒÙ†ÙˆØ² ØªÙˆØª", prompt: "Ø£ÙŠÙ‡ Ø£Ù‡Ù… ÙƒÙ†ÙˆØ² ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ† ÙÙŠ Ø§Ù„Ù…ØªØ­ÙØŸ" },
            { text: "ğŸ¤– Ø¹Ù† ØµØ§ÙÙŠ", prompt: "Ù…Ù† Ù‡ÙŠ ØµØ§ÙÙŠ ÙˆÙ…Ø§ Ù‡ÙŠ Knowing.AIØŸ" },
            { text: "ğŸ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ°Ø§ÙƒØ±", prompt: "Ø£Ø³Ø¹Ø§Ø± ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…ØªØ­Ù Ø£ÙŠÙ‡ØŸ" },
            { text: "ğŸš— Ø¥Ø²Ø§ÙŠ Ø£Ø±ÙˆØ­", prompt: "ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŸ" }
        ],
        kidsMenuTitle: "ğŸ‘¶ğŸ» Ù‚Ø§Ø¦Ù…Ø© Ù‚ØµØµ Ø§Ù„Ø£Ø·ÙØ§Ù„",
        kidsStories: [
            { text: "ğŸ‘‘ Ø­ÙƒØ§ÙŠØ© Ø§Ù„Ù…Ù„Ùƒ Ø±Ù…Ø³ÙŠØ³ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨Ø·Ù„ Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¹Ø¯Ù„)", prompt: "Ø§Ø­ÙƒÙŠ Ù‚ØµØ© Ø§Ù„Ù…Ù„Ùƒ Ø±Ù…Ø³ÙŠØ³ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù„Ù„Ø£Ø·ÙØ§Ù„" },
            { text: "ğŸ‘¸ğŸ» Ø­ÙƒØ§ÙŠØ© Ø§Ù„Ù…Ù„ÙƒØ© Ø­ØªØ´Ø¨Ø³ÙˆØª (Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ù‚Ù„ ÙˆØ§Ù„Ø¬Ù…Ø§Ù„)", prompt: "Ø§Ø­ÙƒÙŠ Ù‚ØµØ© Ø§Ù„Ù…Ù„ÙƒØ© Ø­ØªØ´Ø¨Ø³ÙˆØª Ù„Ù„Ø£Ø·ÙØ§Ù„" },
            { text: "ğŸº Ø³Ø± Ù‚Ù†Ø§Ø¹ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ† Ø§Ù„Ø°Ù‡Ø¨ÙŠ", prompt: "Ø§Ø­ÙƒÙŠ Ù‚ØµØ© Ø³Ø± Ù‚Ù†Ø§Ø¹ ØªÙˆØª Ø¹Ù†Ø® Ø¢Ù…ÙˆÙ† Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ø£Ø·ÙØ§Ù„" }
        ],
        placeholder: "Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ø¹Ù† Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±... ğŸ›ï¸ (Ù…Ø«Ø§Ù„: Ù…ØªÙ‰ Ø§Ù„Ø§ÙØªØªØ§Ø­ØŸ)"
    },
    en: {
        // UI Text
        slogan: "Know more. Do more.",
        countdownText: "ğŸ›ï¸ The Grand Egyptian Museum (GEM)",
        quickTitle: "ğŸ¯ Quick Prompts",
        sendBtn: "â¤ Send",
        smallNote: "Enjoy Egypt's first authentic AI experience â€¢ Know more. Do more.",
        typing: "SAFI is typing",
        resetBtn: "ğŸ”„ Reset",
        liveInfoTitle: "ğŸ›ï¸ Historic Opening",
        liveInfoText: "The Grand Egyptian Museum (GEM) opens tomorrow, November 1, 2025, in a global ceremony! ğŸŒ",
        factsTitle: "ğŸ“Š Amazing Facts",
        aboutKaiTitle: "ğŸ¯ About Knowing.AI",
        aboutKaiText: "A leading Egyptian AI platform, offering innovative solutions for tourism, education, technology, and Artificial Intelligence.",
        developerLabel: "Developer:",
        developerNote: "Developer: Knowing.AI - KaiGPT",
        footer: "Â© 2025 Knowing.AI â€” Egypt's First Unified AI Platform â€¢ Powered by SAFI",
        footer2: "ğŸ‡ªğŸ‡¬ Made with Love in Egypt â€¢ Â© 2025 Knowing.AI â€” Egypt's First Unified AI Platform â€¢ Powered by SAFI",

        // Stats
        stats: [
            { num: "100K+", label: "Artifacts" },
            { num: "5000+", label: "King Tut's Treasures" },
            { num: "480K", label: "Square Meters" },
            { num: "5M+", label: "Annual Visitors" }
        ],

        // Welcome & SAFI
        welcomeTitle: "Welcome! I am SAFI ğŸ‡ªğŸ‡¬",
        welcomeText1: "I am SAFI, Egypt's first intelligent AI guide from Knowing.AI. I'm here to help you know everything about the Grand Egyptian Museum (GEM), opening tomorrow, November 1, 2025! Ask in Egyptian Arabic or English, and I will answer with love and pride in our great history. ğŸ›ï¸âœ¨",
        newsStrong: "ğŸ‰ Breaking News:",
        welcomeText2: "The Grand Egyptian Museum (GEM), the world's largest archaeological museum, officially opens its doors tomorrow in a magnificent global ceremony!",
        safiDesc: "SAFI - Egypt's first AI model, personality, and influencer, and the first intelligent guide fluent in authentic Egyptian Arabic and English, with expertise in history and the Grand Egyptian Museum (GEM).",
        
        // Prompts & Kids
        quickPrompts: [
            { text: "ğŸ›ï¸ Opening Date", prompt: "When does the Grand Egyptian Museum open?" },
            { text: "ğŸŒ World's Largest", prompt: "What makes GEM the world's largest museum?" },
            { text: "ğŸ‘‘ Tut's Treasures", prompt: "What are the most important Tutankhamun treasures in the museum?" },
            { text: "ğŸ¤– About SAFI", prompt: "Tell me about SAFI and Knowing.AI" },
            { text: "ğŸ« Ticket Prices", prompt: "What are the museum's ticket prices?" },
            { text: "ğŸš— How to get there", prompt: "How can I visit GEM from Cairo?" }
        ],
        kidsMenuTitle: "ğŸ‘¶ğŸ» Kids Stories Menu",
        kidsStories: [
            { text: "ğŸ‘‘ The Story of King Ramses II (Hero of Strength and Justice)", prompt: "Tell the story of King Ramses II for children" },
            { text: "ğŸ‘¸ğŸ» The Story of Queen Hatshepsut (Queen of Mind and Beauty)", prompt: "Tell the story of Queen Hatshepsut for children" },
            { text: "ğŸº The Secret of Tutankhamun's Golden Mask", prompt: "Tell the story of Tutankhamun's Golden Mask for children" }
        ],
        placeholder: "Ask me anything about the Grand Egyptian Museum (GEM)... ğŸ›ï¸ (Example: When is the opening?)"
    }
};

/* ========================= ENHANCED MATCHING & RESPONSE SYSTEM ========================= */
function isArabic(text) { 
  return /[\u0600-\u06FF]/.test(text); 
}

function normalize(s) { 
  return (s || '').toLowerCase()
    .replace(/[^\w\u0600-\u06FF\s]+/g, ' ')
    .replace(/\s+/g, ' ')
    .trim(); 
}

function scoreMatch(text, entry) {
  const norm = normalize(text);
  if (!norm) return 0;
  const tokens = norm.split(' ').filter(Boolean);
  let score = 0;
  
  for (const kw of entry.keywords) {
    const nk = normalize(kw);
    for (const t of tokens) {
      if (t.length < 2) continue;
      if (nk === t) score += 5;
      else if (nk.includes(t) || t.includes(nk)) score += 3;
      else if (nk.startsWith(t) || nk.endsWith(t)) score += 2;
      if (norm.includes(nk)) score += 4;
    }
  }
  
  // Bonus for current events and kids mode
  if (norm.match(/2025|november|1|opening|Ø§ÙØªØªØ§Ø­|ØºØ¯/)) score += 2;
  if (norm.match(/Ø·ÙÙ„|Ø§Ø·ÙØ§Ù„|Ù‚ØµØ©|kids|story|ramses|tutankhamun|hatshepsut/)) score += 5;
  
  return score;
}

function findBestMatch(text) {
  const candidates = [];
  for (const entry of ENHANCED_KNOWLEDGE) {
    const score = scoreMatch(text, entry);
    if (score > 0) candidates.push({ entry, score });
    }
  
  candidates.sort((a, b) => b.score - a.score);
  return candidates.length && candidates[0].score >= 8 ? candidates[0].entry : null; 
}

function getContextualResponse(text, match, isArabic) {
  if (!match) {
    return isArabic ? 
      "Ù…Ø¹Ø°Ø±Ø©Ù‹ØŒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¯ÙŠ Ù…Ø´ Ù…ØªÙˆÙØ±Ø© Ø¯Ù„ÙˆÙ‚ØªÙŠ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙŠ. Ù…Ù…ÙƒÙ† ØªØ¬Ø±Ø¨ ØªØ³Ø£Ù„ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ ØªØ®ØªØ§Ø± Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ Ø£Ù†Ø§ Ù‡Ù†Ø§ Ø¹Ø´Ø§Ù† Ø£Ø³Ø§Ø¹Ø¯Ùƒ! ğŸ˜Š" :
      "I'm sorry, that information isn't available in my current database. Could you try rephrasing your question or choose from the quick prompts in the sidebar? I'm here to help! ğŸ˜Š";
  }
  
  const response = isArabic ? (match.a_ar || match.a_en) : (match.a_en || match.a_ar);
  
  const now = new Date();
  const opening = new Date('2025-11-01');
  const isOpeningDay = now.toDateString() === opening.toDateString();
  
  if (isOpeningDay && match.id === 1) {
    return response + (isArabic ? 
      "\n\nğŸ‰ Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ! Ø§Ù„Ù…ØªØ­Ù Ø¨ÙŠÙØªØ­ Ø¯Ù„ÙˆÙ‚ØªÙŠ!" :
      "\n\nğŸ‰ Today is the historic day! GEM is opening right now!");
  }
  
  return response;
}

/* ========================= ENHANCED APP CORE ========================= */
const app = {
  isVoice: false,
  recognition: null,
  currentLanguage: 'ar',
  currentTheme: 'dark',
  
  init() {
    this.messagesEl = document.getElementById('messages');
    this.input = document.getElementById('input');
    this.voiceBtn = document.getElementById('voiceBtn');
    this.setupSpeech();
    this.bind();
    this.updateCountdown();
    this.updateUI(this.currentLanguage);
    setInterval(() => this.updateCountdown(), 1000);
  },

  bind() {
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey && document.activeElement === this.input) {
        e.preventDefault();
        this.send();
      }
    });
  },

  updateCountdown() {
    const now = new Date();
    const opening = new Date('2025-11-01T00:00:00+02:00'); // Egypt timezone
    const diff = opening - now;
    
    if (diff <= 0) {
      document.getElementById('countdown').innerHTML = 'ğŸ‰ OPEN NOW!';
      return;
    }
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    
    const lang = this.currentLanguage;
    if (days > 0) {
      document.getElementById('countdown').innerHTML = `${days} ${lang === 'ar' ? 'ÙŠÙˆÙ… Ù…ØªØ¨Ù‚ÙŠ' : 'Days Left'}`;
    } else {
      document.getElementById('countdown').innerHTML = `${hours}h ${minutes}m`;
    }
  },

  /* NEW: Theme Toggle */
  toggleTheme() {
    const body = document.body;
    this.currentTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
    body.className = this.currentTheme + '-mode';
  },

  /* NEW: Language/UI Toggle */
  updateUI(lang) {
    const data = CONTENT[lang];
    
    // 1. Root & HTML Dir
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';

    // 2. Static Texts (Slogan, Footers, Titles)
    document.getElementById('slogan').innerText = data.slogan;
    document.getElementById('countdown-text').innerText = data.countdownText;
    document.getElementById('quick-title').innerText = data.quickTitle;
    document.getElementById('send-btn').innerText = data.sendBtn;
    document.getElementById('small-note').innerText = data.smallNote;
    document.getElementById('live-info-title').innerText = data.liveInfoTitle;
    document.getElementById('live-info-text').innerText = data.liveInfoText;
    document.getElementById('facts-title').innerText = data.factsTitle;
    document.getElementById('about-kai-title').innerText = data.aboutKaiTitle;
    document.getElementById('about-kai-text').innerText = data.aboutKaiText;
    document.getElementById('developer-note').innerText = data.developerNote;
    document.getElementById('footer').childNodes[0].nodeValue = data.footer;
    document.getElementById('app-footer-2').childNodes[0].nodeValue = data.footer2;
    document.getElementById('reset-btn').innerText = data.resetBtn;
    document.getElementById('main-title').childNodes[2].textContent = lang === 'ar' ? 'ğŸ›ï¸ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±' : 'ğŸ›ï¸ GEM OPENING';

    // 3. Stats & Welcome (Dynamic)
    data.stats.forEach((stat, index) => {
        document.getElementById(`stat-${index+1}`).innerText = stat.num;
        document.getElementById(`label-${index+1}`).innerText = stat.label;
    });
    document.getElementById('welcome-title').innerText = data.welcomeTitle;
    document.getElementById('welcome-text-1').innerText = data.welcomeText1;
    document.getElementById('news-strong').innerText = data.newsStrong;
    document.getElementById('welcome-text-2').childNodes[1].nodeValue = data.welcomeText2; 
    document.getElementById('safi-desc').innerText = data.safiDesc;
    
    // 4. Quick Prompts
    const quickEl = document.getElementById('quick-prompts');
    quickEl.innerHTML = '';
    data.quickPrompts.forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.onclick = () => app.sendPrompt(item.prompt);
        btn.innerText = item.text;
        quickEl.appendChild(btn);
    });

    // 5. Composer/Input
    document.getElementById('input').placeholder = data.placeholder;
    this.updateCountdown(); 
  },

  toggleLanguage() {
    this.currentLanguage = this.currentLanguage === 'ar' ? 'en' : 'ar';
    this.updateUI(this.currentLanguage);
    
    const currentText = this.input.value.trim();
    if (currentText) {
      this.input.value = ''; 
    }
  },

  /* NEW: Show Kids Stories Menu */
  showKidsMenu() {
    const data = CONTENT[this.currentLanguage];
    const stories = data.kidsStories;
    
    const welcome = document.getElementById('welcome');
    if (welcome) welcome.remove();
    this.removeTyping();

    let kidsMenu = document.getElementById('kids-menu');
    if (kidsMenu) kidsMenu.remove();
    
    kidsMenu = document.createElement('div');
    kidsMenu.className = 'msg bot';
    kidsMenu.id = 'kids-menu';
    
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.innerHTML = '<div style="font-size:36px">ğŸ‘¸ğŸ»</div>';
    
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    
    bubble.innerHTML = `
      <div class="title-small">SAFI</div>
      <div class="story-menu">
        <div class="story-menu-title">
            ğŸ‘¶ğŸ» ${data.kidsMenuTitle}
        </div>
        ${stories.map(story => `
            <button onclick="app.sendPrompt('${story.prompt}')">
                <span>${story.text}</span>
                <span>â­</span>
            </button>
        `).join('')}
      </div>
      <p style="margin-top:10px; color:var(--muted); font-size:14px;">${this.currentLanguage === 'ar' ? 'Ø§Ø®ØªØ± Ù‚ØµØ© Ù„ØªØ¨Ø¯Ø£ Ù…ØªØ¹Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù!' : 'Choose a story to start the fun of discovery!'}</p>
    `;
    
    kidsMenu.appendChild(avatar);
    kidsMenu.appendChild(bubble);
    this.messagesEl.appendChild(kidsMenu);
    this.scrollBottom();
  },

  setupSpeech() {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      this.recognition = new SR();
      this.recognition.continuous = false;
      this.recognition.interimResults = false;
      this.recognition.onresult = (e) => {
        const transcript = e.results[0][0].transcript;
        this.input.value = transcript;
        this.onInput();
        this.send(); 
      };
      this.recognition.onerror = () => {};
    }
    
    if (window.speechSynthesis) {
      window.speechSynthesis.getVoices();
    }
  },

  toggleRecording() {
    if (!this.recognition) {
      alert(this.currentLanguage === 'ar' ? 'Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù…ØªØµÙØ­Ùƒ.' : 'Speech recognition not supported in this browser.');
      return;
    }
    
    try {
      if (this.recognition._running) {
        this.recognition.stop();
        this.recognition._running = false;
        document.getElementById('mic').style.background = '';
      } else {
        this.recognition.lang = this.currentLanguage === 'ar' ? 'ar-EG' : 'en-US';
        this.recognition.start();
        this.recognition._running = true;
        document.getElementById('mic').style.background = 'var(--accent)';
        document.getElementById('mic').style.color = 'var(--bg)';
      }
    } catch (e) {
      console.error('Speech recognition error:', e);
    }
  },

  toggleVoice() {
    this.isVoice = !this.isVoice;
    this.voiceBtn.style.background = this.isVoice ? 'var(--accent)' : '';
    this.voiceBtn.style.color = this.isVoice ? 'var(--bg)' : '';
  },

  showInfo() {
    const info = this.currentLanguage === 'ar' ? 
      `
ğŸ›ï¸ Ø§Ù„Ù…ØªØ­Ù Ø§Ù„Ù…ØµØ±ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± - Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©:

ğŸ“… Ø§Ù„Ø§ÙØªØªØ§Ø­: 1 Ù†ÙˆÙÙ…Ø¨Ø± 2025
ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ù‡Ø¶Ø¨Ø© Ø§Ù„Ø¬ÙŠØ²Ø©ØŒ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£Ù‡Ø±Ø§Ù…Ø§Øª
ğŸ« Ø§Ù„Ø³Ø¹Ø±: 30 ÙŠÙˆØ±Ùˆ Ù„Ù„Ø£Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø¨Ø§Ù„ØºÙŠÙ†
â° Ø§Ù„Ø­Ø¬Ø²: ÙŠØ¨Ø¯Ø£ 4 Ù†ÙˆÙÙ…Ø¨Ø± Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±

ğŸ¤– ØªÙ… ØªØ·ÙˆÙŠØ±ÙŠ Ø¨ÙˆØ§Ø³Ø·Ø© Knowing.AI
ğŸ’¡ Ø´Ø¹Ø§Ø±Ù†Ø§: Ø§Ø¹Ø±Ù Ø§ÙƒØªØ±. Ø§ÙØ¹Ù„ Ø§ÙƒØªØ±.
      ` : 
      `
ğŸ›ï¸ Grand Egyptian Museum (GEM) - Quick Info:

ğŸ“… Opening: November 1, 2025
ğŸ“ Location: Giza Plateau, next to the Pyramids
ğŸ« Price: â‚¬30 for adult foreigners
â° Booking: Starts November 4th for the public

ğŸ¤– Developed by Knowing.AI
ğŸ’¡ Slogan: Know more. Do more.
      `;
    this.addMessage(info.trim(), 'bot');
  },

  sendPrompt(text) {
    this.input.value = text;
    this.send();
  },

  send() {
    const text = this.input.value.trim();
    if (!text) return;
    
    this.addMessage(text, 'user');
    this.input.value = '';
    this.onInput();
    this.showTyping();
    
    setTimeout(() => this.respond(text), Math.random() * 800 + 400);
  },

  addMessage(content, role) {
    const welcome = document.getElementById('welcome');
    if (welcome) welcome.remove();
    const kidsMenu = document.getElementById('kids-menu');
    if (kidsMenu) kidsMenu.remove();
    
    const row = document.createElement('div');
    row.className = 'msg ' + (role === 'user' ? 'user' : 'bot');
    
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.innerHTML = role === 'user' ? 
      '<div style="font-size:28px">ğŸ™‹â€â™‚ï¸</div>' : 
      '<div style="font-size:36px">ğŸ‘¸ğŸ»</div>';
    
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    
    if (role === 'bot') {
      bubble.innerHTML = '<div class="title-small">SAFI</div>' + this.escapeHtml(content).replace(/\n/g, '<br>');
    } else {
      bubble.innerHTML = this.escapeHtml(content).replace(/\n/g, '<br>');
    }
    
    row.appendChild(avatar);
    row.appendChild(bubble);
    this.messagesEl.appendChild(row);
    this.scrollBottom();
  },

  showTyping() {
    const data = CONTENT[this.currentLanguage];
    this.removeTyping();
    this.typing = document.createElement('div');
    this.typing.className = 'msg bot';
    this.typing.id = 'typing';
    
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.innerHTML = '<div style="font-size:36px">ğŸ‘¸ğŸ»</div>';
    
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.innerHTML = `
      <div class="title-small">SAFI</div>
      <div style="color:var(--muted);display:flex;align-items:center;gap:8px">
        <span>${data.typing}</span>
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
    `;
    
    this.typing.appendChild(avatar);
    this.typing.appendChild(bubble);
    this.messagesEl.appendChild(this.typing);
    this.scrollBottom();
  },

  removeTyping() {
    const typing = document.getElementById('typing');
    if (typing) typing.remove();
  },

  respond(userText) {
    this.removeTyping();
    
    const match = findBestMatch(userText);
    const isUserArabic = isArabic(userText);
    this.currentLanguage = isUserArabic ? 'ar' : 'en';
    this.updateUI(this.currentLanguage);
    
    const reply = getContextualResponse(userText, match, isUserArabic);
    
    this.addMessage(reply, 'bot');
    
    if (this.isVoice) {
      this.speak(reply, isUserArabic ? 'ar-EG' : 'en-US');
    }
  },

  speak(text, lang) {
    if (!('speechSynthesis' in window)) return;
    
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text.replace(/[ğŸ›ï¸ğŸ‰ğŸ‘‘ğŸŒğŸš€ğŸŒâœˆï¸ğŸ”¬ğŸ«ğŸ—ï¸ğŸ“§ğŸŠğŸºğŸš—â›µğŸ‘¨â€ğŸ’»ğŸ˜Šâ­]/g, ''));
    utterance.lang = lang || 'ar-EG';
    utterance.rate = 0.9; 
    utterance.pitch = 1.1; 
    
    const voices = window.speechSynthesis.getVoices();
    if (voices && voices.length) {
      let selectedVoice = null;
      
      if (lang && lang.startsWith('ar')) {
        // Try to find a clear female Arabic voice
        selectedVoice = voices.find(v => 
          v.lang && v.lang.startsWith('ar') && 
          /female|woman|sara|salma|mona|hoda/i.test(v.name)
        ) || voices.find(v => v.lang && v.lang.startsWith('ar') && /female/i.test(v.name));
      } else {
        // Try to find a clear female English voice
        selectedVoice = voices.find(v => 
          v.lang && v.lang.startsWith('en') && 
          /female|woman|samantha|karen|zira|eloquence/i.test(v.name)
        ) || voices.find(v => v.lang && v.lang.startsWith('en') && /female/i.test(v.name));
      }
      
      if (selectedVoice) utterance.voice = selectedVoice;
    }
    
    window.speechSynthesis.speak(utterance);
  },

  scrollBottom() {
    setTimeout(() => {
      this.messagesEl.scrollTop = this.messagesEl.scrollHeight + 200;
    }, 100);
  },

  reset() {
    if (confirm(this.currentLanguage === 'ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.' : 'Start a new conversation? All messages will be cleared.')) {
      location.reload();
    }
  },

  onInput() {
    const input = this.input;
    input.style.height = 'auto';
    input.style.height = Math.min(input.scrollHeight, 260) + 'px';
  },

  onKey(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      this.send();
    }
  },

  escapeHtml(text) {
    return String(text)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;')
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); 
  }
};

// Initialize app when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  app.init();
  console.log('ğŸ‡ªğŸ‡¬ KaiGPT â€¢ SAFI â€” Grand Egyptian Museum Edition loaded successfully!');
  console.log('Developer: Knowing.AI - KaiGPT');
});

// Global app exposure
window.app = app;
</script>
</body>
</html>
