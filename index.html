<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KaiGPT ‚Ä¢ SAFI ‚Äî Knowing.AI (GEM Opening Edition)</title>
<meta name="description" content="KaiGPT powered by SAFI ‚Äî Egypt's First AI Guide for the Grand Egyptian Museum. The world's largest archaeological museum opens November 1, 2025!"/>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%23000000'/%3E%3Ccircle cx='32' cy='32' r='22' fill='none' stroke='%23ffffff' stroke-width='2.5'/%3E%3C/circle%3E%3C/svg%3E">
<style>
  /* --- 1. ROOT VARIABLES (DARK MODE - AMAZING BLACK) --- */
  :root{
    --bg: #000000; 
    --panel: #0a0a0a; 
    --muted: #999999; 
    --text: #ffffff; 
    --accent: #ffffff; 
    --secondary-accent: #e0e0e0; 
    --gold: #ffffff; 
    --egyptian-blue: #0f0f0f; 
    --glass: rgba(255,255,255,0.05); 
    --shadow: rgba(255,255,255,0.05); 
    --radius:12px;
    --max-width:980px;
  }
  
  /* --- 2. LIGHT MODE (AMAZING WHITE) --- */
  body.light-mode {
    --bg: #ffffff; 
    --panel: #f0f0f0; 
    --muted: #666666; 
    --text: #000000; 
    --accent: #000000; 
    --secondary-accent: #333333; 
    --gold: #000000; 
    --egyptian-blue: #eeeeee; 
    --glass: rgba(0,0,0,0.05); 
    --shadow: rgba(0,0,0,0.1); 
    background: linear-gradient(180deg,var(--bg),#fcfcfc);
  }

  /* --- 3. BASE STYLES --- */
  *{box-sizing:border-box}
  html,body{
    height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, "Cairo", system-ui, -apple-system;
    background:linear-gradient(180deg,var(--bg),#050505);
    color:var(--text);-webkit-font-smoothing:antialiased;
    transition: background 0.5s, color 0.5s;
  }
  a{color:var(--secondary-accent);text-decoration:none}

  /* Enhanced animations */
  @keyframes glow {
    0%, 100% { box-shadow: 0 0 10px var(--shadow); }
    50% { box-shadow: 0 0 20px var(--shadow); }
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  @keyframes slideIn {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  /* --- 4. LAYOUT --- */
  .root{display:flex;min-height:100vh;padding:18px;gap:18px}
  .sidebar{
    width:340px;background:linear-gradient(180deg,var(--panel),var(--bg));border-radius:var(--radius);
    padding:20px;display:flex;flex-direction:column;gap:16px;border:1px solid var(--glass);
    box-shadow:0 8px 30px rgba(0,0,0,0.8);
    transition: background 0.5s, border-color 0.5s;
  }

  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:72px;height:72px;border-radius:12px;background:var(--egyptian-blue);
    display:flex;align-items:center;justify-content:center;border:2px solid var(--glass); 
    font-weight:800;color:var(--accent); font-size:18px;
    position:relative;overflow:hidden;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  
  .brand h1{margin:0;font-size:19px;background:linear-gradient(135deg, var(--accent), var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  .brand .sub{color:var(--muted);font-size:13px;margin-top:2px}

  .slogan{font-weight:700;color:var(--accent);margin-top:8px;font-size:15px}
  .powered{color:var(--muted);font-size:12px;margin-top:12px}

  .countdown{
    background:linear-gradient(135deg, var(--egyptian-blue), var(--panel));
    padding:16px;border-radius:12px;text-align:center;margin:12px 0;
    border:1px solid var(--glass);
    animation:glow 2s ease-in-out infinite;
  }
  .countdown-text{font-weight:800;color:var(--text);font-size:14px;margin-bottom:8px}
  .countdown-time{font-size:20px;font-weight:900;color:var(--accent);text-shadow:0 0 8px var(--shadow)}

  .stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0}
  .stat{background:var(--glass);padding:12px;border-radius:8px;text-align:center;border:1px solid var(--glass)}
  .stat-number{font-size:18px;font-weight:800;color:var(--accent)}
  .stat-label{font-size:11px;color:var(--muted);margin-top:4px}

  /* Quick buttons section */
  .quick button{background:transparent;border:1px solid var(--glass);color:var(--muted);padding:12px;border-radius:10px;text-align:right;cursor:pointer;transition:all 0.3s ease}
  .quick button:hover{color:var(--text);background:var(--glass);border-color:var(--accent);transform:translateX(-3px)}

  .sidebar .footer{margin-top:auto;color:var(--muted);font-size:12px;text-align:center;padding:12px 0;border-top:1px solid var(--glass)}

  /* --- 5. MAIN CONTENT --- */
  .main{flex:1;display:flex;flex-direction:column;gap:12px}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:6px 12px}
  .title{font-size:22px;font-weight:800;background:linear-gradient(135deg, var(--accent), var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  .tag{background:var(--glass);padding:8px 12px;border-radius:10px;color:var(--accent);font-weight:700;border:1px solid var(--glass)}

  .container{flex:1;display:flex;gap:18px;align-items:stretch}
  .chat-column{flex:1;max-width:var(--max-width);margin:0 auto;display:flex;flex-direction:column;border-radius:var(--radius);overflow:hidden;border:1px solid var(--glass);background:linear-gradient(180deg,rgba(0,0,0,0.01),transparent)}
  .messages{flex:1;padding:28px;overflow:auto;display:flex;flex-direction:column;gap:18px;min-height:420px}
  
  .welcome{display:flex;gap:16px;align-items:flex-start;padding:18px;border-radius:12px;background:linear-gradient(180deg, var(--glass), transparent);animation:slideIn 0.6s ease-out}
  .avatar{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;background:var(--egyptian-blue);border:3px solid var(--glass);position:relative}
  .avatar::after{content:'';position:absolute;inset:-3px;border-radius:50%;background:conic-gradient(var(--accent), var(--secondary-accent), var(--accent));z-index:-1;animation:spin 4s linear infinite}
  
  .welcome-text h2{margin:0 0 8px 0;font-size:24px;background:linear-gradient(135deg, var(--accent), var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  .welcome-text p{margin:0;color:var(--muted);line-height:1.6;max-width:720px}
  .welcome-text p:last-of-type{padding:12px;background:var(--glass);border-radius:8px;border:1px solid var(--glass)}
  .welcome-text strong{color:var(--accent)}

  .msg{display:flex;gap:12px;align-items:flex-start;animation:slideIn 0.4s ease-out}
  .msg.user{flex-direction:row-reverse;justify-content:flex-end}
  .bubble{padding:16px 18px;border-radius:12px;max-width:78%;line-height:1.6;white-space:pre-wrap;word-wrap:break-word;position:relative;box-shadow: 0 4px 12px rgba(0,0,0,0.2)}
  .msg.user .bubble{background:linear-gradient(180deg, var(--glass), rgba(255,255,255,0.02));color:var(--text);border:1px solid var(--glass)}
  .msg.bot .bubble{background:linear-gradient(180deg, var(--panel), var(--bg));color:var(--text);border:1px solid var(--glass)}
  .bubble .title-small{font-weight:700;color:var(--accent);font-size:14px;margin-bottom:8px;display:flex;align-items:center;gap:8px}
  .bubble .title-small::before{content:'üë∏üèª';font-size:16px}
  
  /* Styling for the new kids' stories popup */
  .story-menu {
      background: var(--panel);
      padding: 18px;
      border-radius: 12px;
      margin-top: 12px;
      border: 1px solid var(--glass);
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
  }
  .story-menu-title {
      font-weight: 800;
      color: var(--accent);
      font-size: 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
  }
  .story-menu button {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--glass);
      color: var(--text);
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      text-align: right;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
  .story-menu button:hover {
      background: var(--glass);
      border-color: var(--accent);
  }

  .composer{padding:18px;border-top:1px solid var(--glass);background:linear-gradient(180deg, rgba(255,255,255,0.005), transparent)}
  .composer-inner{display:flex;gap:12px;align-items:flex-end;max-width:var(--max-width);margin:0 auto}
  textarea.input{flex:1;min-height:56px;max-height:260px;resize:none;border-radius:12px;padding:16px;background:var(--panel);border:1px solid var(--glass);color:var(--text);font-size:16px;outline:none;font-family:inherit;transition:border-color 0.3s ease}
  textarea.input:focus{border-color:var(--accent);box-shadow:0 0 0 2px var(--shadow)}
  
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:transparent;border:1px solid var(--glass);color:var(--text);padding:12px 14px;border-radius:10px;cursor:pointer;transition:all 0.3s ease}
  .btn:hover{background:var(--glass);border-color:var(--accent)}
  .btn.primary{
    background:linear-gradient(90deg,var(--accent),var(--secondary-accent));
    color:var(--bg); 
    border:1px solid var(--accent);font-weight:800;
    box-shadow:0 8px 20px var(--shadow);transform:scale(1)
  }
  .btn.primary:hover{transform:scale(1.05);box-shadow:0 12px 30px var(--shadow);border-color:var(--secondary-accent)}

  .small-note{color:var(--muted);font-size:13px;text-align:center;margin-top:10px}

  .right-col{width:340px;display:flex;flex-direction:column;gap:12px}
  .card{background:linear-gradient(180deg, var(--glass), transparent);padding:16px;border-radius:12px;border:1px solid var(--glass);color:var(--muted)}
  .card h3{margin:0 0 10px 0;color:var(--text);font-size:16px}

  .live-info{background:linear-gradient(135deg, var(--bg), var(--panel));border:2px solid var(--accent);animation:glow 3s ease-in-out infinite}
  .live-badge{display:inline-flex;align-items:center;gap:6px;background:var(--accent);color:var(--bg);padding:4px 8px;border-radius:6px;font-size:11px;font-weight:800;margin-bottom:8px}
  .live-dot{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:pulse 1s infinite}

  /* --- 6. MEDIA QUERIES --- */
  @media (max-width:1100px){
    .root{padding:12px;flex-direction:column}
    .sidebar{width:100%;order:2}
    .right-col{width:100%;order:3}
    .chat-column{max-width:100%;order:1}
    .container{flex-direction:column}
    .msg.user{flex-direction:row}
    .bubble{max-width:90%}
  }

  /* Typing indicator */
  .typing-dots{display:inline-flex;gap:4px;align-items:center}
  .typing-dot{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:typing 1.4s infinite}
  .typing-dot:nth-child(2){animation-delay:0.2s}
  .typing-dot:nth-child(3){animation-delay:0.4s}
  @keyframes typing {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-10px); }
  }

  footer.app-footer{
    width:100%; text-align:center; padding:16px 0; color:var(--muted); font-size:12px;
    background:transparent; border-top:1px solid var(--glass)
  }
</style>
</head>
<body class="dark-mode">
  <div class="root" role="application" aria-label="KaiGPT ‚Ä¢ SAFI">
    <aside class="sidebar" aria-label="Sidebar">
      <div>
        <div class="brand">
          <div class="logo" aria-hidden="true">KAI</div>
          <div>
            <h1>Knowing.AI</h1>
            <div class="sub">KaiGPT ‚Ä¢ SAFI ‚Äî <span id="gem-edition">GEM</span> Opening Edition</div>
          </div>
        </div>

        <div class="slogan" id="slogan">‚ÄúKnow more. Do more.‚Äù</div>

        <div class="countdown">
          <div class="countdown-text" id="countdown-text">üèõÔ∏è ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±</div>
          <div class="countdown-time" id="countdown">OPENING DAY!</div>
          <div style="font-size:12px;color:var(--text);margin-top:4px" id="countdown-date">1 November 2025</div>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="stat-number" id="stat-1">100K+</div>
            <div class="stat-label" id="label-1">ŸÇÿ∑ÿπÿ© ÿ£ÿ´ÿ±Ÿäÿ©</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="stat-2">5000+</div>
            <div class="stat-label" id="label-2">ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="stat-3">480K</div>
            <div class="stat-label" id="label-3">ŸÖ¬≤ ŸÖÿ≥ÿßÿ≠ÿ©</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="stat-4">5M</div>
            <div class="stat-label" id="label-4">ÿ≤ÿßÿ¶ÿ± ÿ≥ŸÜŸàŸäÿßŸã</div>
          </div>
        </div>

        <div style="margin-top:14px;">
          <div class="card" style="margin-bottom:12px">
            <strong style="color:var(--text)" id="safi-title-small">SAFI ‚Äî ÿßŸÑŸÖÿ±ÿ¥ÿØÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ© ÿßŸÑÿ∞ŸÉŸäÿ©</strong>
            <div style="margin-top:8px;color:var(--muted);font-size:13px" id="safi-desc">
              ÿµÿßŸÅŸä -ÿ£ŸàŸÑ ŸÜŸÖŸàÿ∞ÿ¨ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿµÿ±Ÿä Ÿàÿ¥ÿÆÿµŸäÿ© ŸàŸÖÿ§ÿ´ÿ±ÿ©ÿå Ÿàÿ£ŸàŸÑ ŸÖÿ±ÿ¥ÿØÿ© ÿ∞ŸÉŸäÿ© ÿ™ÿ™ÿ≠ÿØÿ´ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ© ÿßŸÑÿ£ÿµŸäŸÑÿ© ŸàÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ÿ®ÿ∑ŸÑÿßŸÇÿ©ÿå Ÿàÿ™ÿ™ŸÖÿ™ÿπ ÿ®ÿÆÿ®ÿ±ÿ© ŸÅŸä ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±.
            </div>
          </div>

          <div class="card" style="margin-bottom:12px">
            <button class="btn primary" style="width:100%; color: var(--bg); font-size:16px;" onclick="app.showKidsMenu()">
              üë∂üèª Ÿàÿ∂ÿπ ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ - ÿßŸÑŸÇÿµÿµ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ©
            </button>
          </div>

          <div class="card">
            <div style="font-weight:700;margin-bottom:8px;color:var(--text)" id="quick-title">üéØ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≥ÿ±Ÿäÿπÿ©</div>
            <div style="display:flex;flex-direction:column;gap:8px" id="quick-prompts">
              </div>
          </div>
        </div>
      </div>

      <div class="footer" id="footer">
        ¬© 2025 Knowing.AI ‚Äî Egypt's First Unified AI Platform ‚Ä¢ Powered by SAFI
        <div id="developer-note">Developer: Knowing.AI - KaiGPT</div>
      </div>
    </aside>

    <main class="main" role="main">
      <div class="topbar">
        <div class="title" id="main-title">KaiGPT <span class="tag" style="margin-left:12px"><span id="tag-text">üèõÔ∏è GEM OPENING</span></span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" onclick="app.toggleTheme()" title="ÿ™ÿ®ÿØŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ∂ÿßÿ°ÿ©">üîÜ</button>
          <button class="btn" onclick="app.toggleLanguage()" title="ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÑÿ∫ÿ© ŸàÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©">üåê</button>
          <button class="btn" onclick="app.reset()" id="reset-btn">üîÑ Reset</button>
          <button id="voiceBtn" class="btn" onclick="app.toggleVoice()" title="ÿ™ŸÅÿπŸäŸÑ/ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ±ÿØ ÿßŸÑÿµŸàÿ™Ÿä">üé§ Voice</button>
          <button class="btn" onclick="app.showInfo()">‚ÑπÔ∏è Info</button>
        </div>
      </div>

      <div class="container">
        <section class="chat-column" aria-label="Chat Column">
          <div class="messages" id="messages" role="log" aria-live="polite">
            <div class="welcome" id="welcome">
              <div class="avatar" aria-hidden="true">üë∏üèª</div>
              <div class="welcome-text">
                <h2 id="welcome-title">ÿ£ŸáŸÑÿßŸã ÿ®ŸäŸÉ! ÿ£ŸÜÿß ÿµÿßŸÅŸä üá™üá¨</h2>
                <p id="welcome-text-1">ÿ£ŸÜÿß ÿµÿßŸÅŸäÿå ÿ£ŸàŸÑ ŸÖÿ±ÿ¥ÿØÿ© ÿ∞ŸÉŸäÿ© ŸÖÿµÿ±Ÿäÿ© ŸÖŸÜ Knowing.AIÿå Ÿàÿ£ŸÜÿß ŸáŸÜÿß ÿπÿ¥ÿßŸÜ ÿ£ÿ≥ÿßÿπÿØŸÉ ÿ™ÿπÿ±ŸÅ ŸÉŸÑ ÿ≠ÿßÿ¨ÿ© ÿπŸÜ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ÿßŸÑŸÑŸä ŸáŸäŸÅÿ™ÿ≠ ÿ®ŸÉÿ±ÿ© 1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025! ÿ•ÿ≥ÿ£ŸÑ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿä ÿßŸÑŸÖÿµÿ±Ÿä ÿ£Ÿà ÿ®ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿå ŸàŸáÿ¨ÿßŸàÿ®ŸÉ ÿ®ŸÉŸÑ ÿ≠ÿ® ŸàŸÅÿÆÿ± ÿ®ÿ™ÿßÿ±ŸäÿÆŸÜÿß ÿßŸÑÿπÿ∏ŸäŸÖ. üèõÔ∏è‚ú®</p>
                <p style="margin-top:12px;" id="welcome-text-2">
                  <strong id="news-strong">üéâ ÿÆÿ®ÿ± ÿπÿßÿ¨ŸÑ:</strong> ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿå ÿ£ŸÉÿ®ÿ± ŸÖÿ™ÿ≠ŸÅ ÿ£ÿ´ÿ±Ÿä ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿå ŸäŸÅÿ™ÿ≠ ÿ£ÿ®Ÿàÿßÿ®Ÿá ÿ±ÿ≥ŸÖŸäÿßŸã ÿ®ŸÉÿ±ÿ© ŸÅŸä ÿ≠ŸÅŸÑ ÿπÿßŸÑŸÖŸä ŸÖŸáŸäÿ®!
                </p>
              </div>
            </div>
          </div>

          <div class="composer" aria-label="Composer">
            <div class="composer-inner">
              <textarea id="input" class="input" placeholder="ÿßÿ≥ÿ£ŸÑŸÜŸä ÿ£Ÿä ÿ≠ÿßÿ¨ÿ© ÿπŸÜ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±... üèõÔ∏è (ŸÖÿ´ÿßŸÑ: ŸÖÿ™Ÿâ ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠ÿü)" oninput="app.onInput()" onkeydown="app.onKey(event)"></textarea>
              <div class="controls">
                <button id="mic" class="btn" onclick="app.toggleRecording()" title="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµŸàÿ™Ÿä">üéôÔ∏è</button>
                <button class="btn primary" onclick="app.send()" id="send-btn">‚û§ ÿ•ÿ±ÿ≥ÿßŸÑ</button>
              </div>
            </div>
            <div class="small-note" id="small-note">‚ÄúKnow more. Do more.‚Äù</div>
          </div>
        </section>

        <aside class="right-col" aria-hidden="true">
          <div class="card live-info">
            <div class="live-badge">
              <div class="live-dot"></div>
              LIVE UPDATE
            </div>
            <h3 id="live-info-title">üèõÔ∏è ÿßŸÅÿ™ÿ™ÿßÿ≠ ÿ™ÿßÿ±ŸäÿÆŸä</h3>
            <p id="live-info-text">ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ŸäŸÅÿ™ÿ≠ ÿ∫ÿØÿßŸã 1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025 ŸÅŸä ÿ≠ŸÅŸÑ Ÿäÿ¥ŸáÿØŸá ÿßŸÑÿπÿßŸÑŸÖ ŸÉŸÑŸá! üåç</p>
            <ul style="margin:8px 0;padding:0 0 0 20px;color:var(--text)" id="live-info-list">
              <li>ÿßŸÑÿ®ÿ´ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ÿπŸÑŸâ TikTok</li>
              <li>ÿ≠ÿ∂Ÿàÿ± ŸÇÿßÿØÿ© ŸàŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸÖŸÜ ÿßŸÑÿπÿßŸÑŸÖ</li>
              <li>ÿßŸÅÿ™ÿ™ÿßÿ≠ ŸÖÿπÿßÿ±ÿ∂ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ</li>
            </ul>
          </div>

          <div class="card">
            <h3 id="facts-title">üìä ÿ≠ŸÇÿßÿ¶ŸÇ ŸÖÿ∞ŸáŸÑÿ©</h3>
            <ul style="margin:8px 0 0 18px;color:var(--muted);padding:0;" id="facts-list">
              </ul>
          </div>

          <div class="card">
            <h3 id="about-kai-title">üéØ About Knowing.AI</h3>
            <p id="about-kai-text">ŸÖŸÜÿµÿ© ŸÖÿµÿ±Ÿäÿ© ÿ±ÿßÿ¶ÿØÿ© ŸÑŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸäÿå ÿ™ŸÇÿØŸÖ ÿ≠ŸÑŸàŸÑ ŸÖÿ®ÿ™ŸÉÿ±ÿ© ŸÑŸÑÿ≥Ÿäÿßÿ≠ÿ© ŸàÿßŸÑÿ™ÿπŸÑŸäŸÖ ŸàÿßŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ŸàÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä.</p>
            <div style="margin-top:12px;font-size:12px;color:var(--secondary-accent)">
              <strong id="developer-label">Developer:</strong> Knowing.AI - KaiGPT
            </div>
          </div>
        </aside>
      </div>

      <footer class="app-footer" id="app-footer-2">
        üá™üá¨ Made with Love in Egypt ‚Ä¢ ¬© 2025 Knowing.AI ‚Äî Egypt's First Unified AI Platform ‚Ä¢ Powered by SAFI
      </footer>

    </main>
  </div>

<script>
/* ========================= COMPREHENSIVE KNOWLEDGE BASE (80+ ENTRIES) ========================= */
// ÿ™ŸÖ ÿØŸÖÿ¨ ÿßŸÑŸÄ Ÿ®Ÿ† ÿ≥ÿ§ÿßŸÑ/ÿ¨Ÿàÿßÿ®/Keywords ŸáŸÜÿß
const ENHANCED_KNOWLEDGE = [
  // --- Opening & Basic Info ---
  { id: 1, keywords: ["ŸÖÿ™Ÿâ","ÿßŸÅÿ™ÿ™ÿßÿ≠","opening","when","november","1 november","1 ŸÜŸàŸÅŸÖÿ®ÿ±","ŸÖŸàÿπÿØ","ÿ™ÿßÿ±ŸäÿÆ","date"], a_ar: "üéâ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ŸäŸÅÿ™ÿ≠ ÿ±ÿ≥ŸÖŸäÿßŸã ÿ∫ÿØÿßŸã 1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025 ŸÅŸä ÿ≠ŸÅŸÑ ÿπÿßŸÑŸÖŸä ŸÖŸáŸäÿ®! ÿßŸÑÿ≠ŸÅŸÑ ŸáŸäÿ®ŸÇŸâ live ÿπŸÑŸâ TikTok ŸàÿßŸÑÿπÿßŸÑŸÖ ŸÉŸÑŸá ŸáŸäÿ¥ŸàŸÅ ÿ£ÿπÿ∏ŸÖ ÿßŸÅÿ™ÿ™ÿßÿ≠ ŸÖÿ™ÿ≠ŸÅ ŸÅŸä ÿßŸÑÿ™ÿßÿ±ŸäÿÆ.", a_en: "üéâ The Grand Egyptian Museum (GEM) officially opens tomorrow, November 1, 2025, in a magnificent global ceremony! The event will be live-streamed for the world to witness the greatest museum opening in history." },
  { id: 2, keywords: ["ÿßŸäŸÜ","ÿ£ŸäŸÜ","ŸÖŸÉÿßŸÜ","where","location","giza","ÿßŸÑÿ¨Ÿäÿ≤ÿ©","ÿßŸáÿ±ÿßŸÖÿßÿ™","pyramids","ÿπŸÜŸàÿßŸÜ","address"], a_ar: "üèõÔ∏è ÿßŸÑŸÖÿ™ÿ≠ŸÅ ŸÖŸàÿ¨ŸàÿØ ŸÅŸä Ÿáÿ∂ÿ®ÿ© ÿßŸÑÿ¨Ÿäÿ≤ÿ©ÿå ÿπŸÑŸâ ÿ®ÿπÿØ ŸÖÿ¶ÿßÿ™ ÿßŸÑÿ£ŸÖÿ™ÿßÿ± ŸÖŸÜ ÿ£Ÿáÿ±ÿßŸÖÿßÿ™ ÿßŸÑÿ¨Ÿäÿ≤ÿ© ÿßŸÑÿπÿ∏ŸäŸÖÿ©. ÿßŸÑŸÖŸàŸÇÿπ ŸÖÿ´ÿßŸÑŸä ŸàŸäÿ∑ŸÑ ÿπŸÑŸâ ÿßŸÑÿ£Ÿáÿ±ÿßŸÖÿßÿ™ ŸÖÿ®ÿßÿ¥ÿ±ÿ©!", a_en: "üèõÔ∏è The GEM is located on the Giza plateau, just a few hundred meters from the iconic Pyramids of Giza. The location is perfect with direct views of the pyramids!" },
  { id: 3, keywords: ["ÿßŸÉÿ®ÿ±","ÿßŸÑÿ£ŸÉÿ®ÿ±","world's largest","largest","ŸÖÿ≥ÿßÿ≠ÿ©","size","why largest","480k"], a_ar: "üåç ÿßŸÑŸÖÿ™ÿ≠ŸÅ ŸáŸà ÿßŸÑÿ£ŸÉÿ®ÿ± ÿπÿßŸÑŸÖŸäÿßŸã ŸÑÿ£ŸÜŸá Ÿäÿ∫ÿ∑Ÿä ŸÖÿ≥ÿßÿ≠ÿ© Ÿ§Ÿ®Ÿ† ÿ£ŸÑŸÅ ŸÖÿ™ÿ± ŸÖÿ±ÿ®ÿπ ŸàŸäÿ∂ŸÖ ÿ£ŸÉÿ®ÿ± ÿπÿØÿØ ŸÖŸÜ ÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ© ŸÅŸä ŸÖŸÉÿßŸÜ Ÿàÿßÿ≠ÿØ (ÿ£ŸÉÿ´ÿ± ŸÖŸÜ Ÿ°Ÿ†Ÿ† ÿ£ŸÑŸÅ ŸÇÿ∑ÿπÿ©).", a_en: "üåç The GEM is the world's largest because it covers an area of 480K square meters and houses the largest number of artifacts in one location (more than 100K pieces)." },
  { id: 4, keywords: ["ÿ™Ÿàÿ™","ÿ™Ÿàÿ™ ÿπŸÜÿÆ","tutankhamun","treasures","ŸÉŸÜŸàÿ≤","mask","ŸÇŸÜÿßÿπ","5000","ÿÆŸÖÿ≥ÿ© ÿ¢ŸÑÿßŸÅ"], a_ar: "üëë ŸÑÿ£ŸàŸÑ ŸÖÿ±ÿ© ŸÅŸä ÿßŸÑÿ™ÿßÿ±ŸäÿÆÿå ŸÉŸÑ ŸÉŸÜŸàÿ≤ ÿßŸÑŸÖŸÑŸÉ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ÿßŸÑŸÄŸ•Ÿ†Ÿ†Ÿ† ŸÇÿ∑ÿπÿ© Ÿáÿ™ÿ®ŸÇŸâ ŸÖÿπÿ±Ÿàÿ∂ÿ© ŸÅŸä ŸÖŸÉÿßŸÜ Ÿàÿßÿ≠ÿØ! ÿ¥ÿßŸÖŸÑ ÿßŸÑŸÇŸÜÿßÿπ ÿßŸÑÿ∞Ÿáÿ®Ÿä ÿßŸÑÿ¥ŸáŸäÿ± Ÿàÿ™ŸÖÿßÿ´ŸäŸÑŸá.", a_en: "üëë For the first time in history, all 5,000+ treasures of King Tutankhamun will be displayed in one place at the GEM! This includes the famous golden funeral mask and life-size wooden statues." },
  { id: 5, keywords: ["ÿ™ÿ∞ŸÉÿ±ÿ©","ÿ£ÿ≥ÿπÿßÿ±","tickets","price","how much","ŸÉŸÖ", "ÿ™ŸÉŸÑŸÅÿ©"], a_ar: "üé´ ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ™ÿ∞ÿßŸÉÿ±: ŸÑŸÑÿ£ÿ¨ÿßŸÜÿ® ÿßŸÑÿ®ÿßŸÑÿ∫ŸäŸÜ: Ÿ£Ÿ† ŸäŸàÿ±Ÿàÿå ŸÑŸÑÿ∑ŸÑÿßÿ® ÿßŸÑÿ£ÿ¨ÿßŸÜÿ®: Ÿ°Ÿ• ŸäŸàÿ±Ÿà. ÿßŸÑŸÖÿµÿ±ŸäŸàŸÜ ŸàÿßŸÑÿπÿ±ÿ®: ŸäÿÆÿ™ŸÑŸÅ ÿßŸÑÿ≥ÿπÿ± ÿ≠ÿ≥ÿ® ÿßŸÑŸÅÿ¶ÿ©.", a_en: "üé´ Ticket Prices: For adult foreigners: ‚Ç¨30, for foreign students: ‚Ç¨15. Prices vary for Egyptians and Arabs depending on the category." },

  // --- SAFI & Knowing.AI Info ---
  { id: 6, keywords: ["ÿµÿßŸÅŸä","safi","ŸÖŸÜ ÿßŸÜÿ™Ÿä","who are you","knowing.ai","kai","model"], a_ar: "üë∏üèª ÿ£ŸÜÿß ÿµÿßŸÅŸäÿå ÿ£ŸàŸÑ ŸÖÿ±ÿ¥ÿØÿ© ÿ∞ŸÉŸäÿ© ŸÖÿµÿ±Ÿäÿ© ŸÖŸÜ Knowing.AI. ÿ£ŸÜÿß ÿ£ŸàŸÑ ŸÜŸÖŸàÿ∞ÿ¨ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿµÿ±Ÿä Ÿàÿ¥ÿÆÿµŸäÿ© ŸÖÿ§ÿ´ÿ±ÿ©ÿå ÿ£ÿ™ÿ≠ÿØÿ´ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿ®ÿ∑ŸÑÿßŸÇÿ© ŸàÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©ÿå ŸÖÿ™ÿÆÿµÿµÿ© ŸÅŸä ÿ™ÿßÿ±ŸäÿÆ ŸÖÿµÿ± ŸàÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±.", a_en: "üë∏üèª I am SAFI, Egypt's first intelligent guide from Knowing.AI. I am Egypt's first AI model, personality, and influencer, fluent in Arabic and English, specialized in Egyptian history and the Grand Egyptian Museum (GEM)." },
  { id: 7, keywords: ["what is knowing.ai","ŸÖÿß ŸáŸä","ŸÖŸÜÿµÿ©","platform"], a_ar: "Knowing.AI ŸáŸä ŸÖŸÜÿµÿ© ŸÖÿµÿ±Ÿäÿ© ÿ±ÿßÿ¶ÿØÿ© ŸÑŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸäÿå ÿ™ŸÇÿØŸÖ ÿ≠ŸÑŸàŸÑ ŸÖÿ®ÿ™ŸÉÿ±ÿ© ŸÑŸÑÿ≥Ÿäÿßÿ≠ÿ© ŸàÿßŸÑÿ™ÿπŸÑŸäŸÖ ŸàÿßŸÑÿ£ÿπŸÖÿßŸÑ ŸàÿßŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ŸÅŸä ŸÖÿµÿ±.", a_en: "Knowing.AI is a leading Egyptian AI platform, offering innovative solutions for tourism, education, business, and technology in Egypt." },
  
  // --- Visitor Experience ---
  { id: 8, keywords: ["ÿ•ÿ≤ÿßŸä ÿ£ÿ±Ÿàÿ≠","how to get there","ŸÖŸàÿßÿµŸÑÿßÿ™","transport","taxi","ŸÖÿ™ÿ±Ÿà"], a_ar: "üöó ÿ£ÿ≥ŸáŸÑ ÿ∑ÿ±ŸäŸÇÿ© ŸáŸä ÿßŸÑÿ™ÿßŸÉÿ≥Ÿä ÿ£Ÿà ÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÜŸÇŸÑ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉ (Uber/Careem). ŸÇÿ±Ÿäÿ®ÿßŸã ÿ≥Ÿäÿ™ŸÖ ÿßŸÅÿ™ÿ™ÿßÿ≠ ÿÆÿ∑Ÿàÿ∑ ŸÖÿ™ÿ±Ÿà Ÿàÿ≠ÿßŸÅŸÑÿßÿ™ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑŸÖÿ™ÿ≠ŸÅ.", a_en: "üöó The easiest way is by taxi or ride-sharing services (Uber/Careem). Soon, direct metro and bus lines will open to the museum." },
  { id: 9, keywords: ["ŸÖŸàÿßÿπŸäÿØ","ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿπŸÖŸÑ","hours","time to visit","ÿßŸÖÿ™Ÿâ"], a_ar: "üèõÔ∏è ŸÖŸàÿßÿπŸäÿØ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸàŸÇÿπÿ© ŸáŸä ŸÖŸÜ Ÿ© ÿµÿ®ÿßÿ≠ÿßŸã ÿ≠ÿ™Ÿâ Ÿ¶ ŸÖÿ≥ÿßÿ°Ÿãÿå ŸÖÿπ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿ™ŸÖÿØŸäÿØŸáÿß ŸÅŸä ŸÖŸàÿßÿ≥ŸÖ ÿßŸÑÿ∞ÿ±Ÿàÿ© ÿ£Ÿà ÿßŸÑÿ£ŸÖÿ≥Ÿäÿßÿ™ ÿßŸÑÿÆÿßÿµÿ©.", a_en: "üèõÔ∏è Expected operating hours are from 9 AM to 6 PM, with potential extensions during peak seasons or for special evening events." },
  { id: 10, keywords: ["ÿ™ÿ¨ÿ±ÿ®ÿ©","experience","what to see","ŸÖÿßÿ∞ÿß ÿ£ÿ¥ÿßŸáÿØ","ŸÜÿ¥ÿßÿ∑ÿßÿ™"], a_ar: "ÿ™ÿ¨ÿ±ÿ®ÿ© ŸÑÿß ÿ™ŸèŸÜÿ≥Ÿâ! Ÿáÿ™ÿ¥ŸàŸÅ Ÿáÿ±ŸÖ ÿÆŸàŸÅŸà ÿßŸÑÿ£ŸÉÿ®ÿ±ÿå ŸàŸáÿ™ŸÖÿ¥Ÿä ŸÅŸä ÿßŸÑÿ®ŸáŸà ÿßŸÑÿπÿ∏ŸäŸÖ ŸÑÿ±ÿ§Ÿäÿ© ÿ™ŸÖÿ´ÿßŸÑ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸäÿå Ÿàÿ™ŸÉÿ™ÿ¥ŸÅ ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ÿßŸÑŸÉÿßŸÖŸÑÿ©.", a_en: "An unforgettable experience! You will see the Great Pyramid of Khufu, walk through the Grand Atrium to see the statue of Ramses II, and discover the complete Tutankhamun treasures." },
  
  // --- Kids Stories (Fixed to appear on prompt) ---
  { id: 21, keywords: ["ŸÇÿµÿ© ÿ±ŸÖÿ≥Ÿäÿ≥","ramses story","ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä","ÿ®ÿ∑ŸÑ ÿßŸÑŸÇŸàÿ©","tell story ramses"], a_ar: "üëë **ŸÇÿµÿ© ÿßŸÑŸÖŸÑŸÉ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä - ÿ®ÿ∑ŸÑ ÿßŸÑŸÇŸàÿ© ŸàÿßŸÑÿπÿØŸÑ:** ÿ™ÿÆŸäŸÑ Ÿäÿß ÿ®ÿ∑ŸÑ ÿ£ŸÜ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿ™ŸàŸÑŸâ ÿßŸÑÿ≠ŸÉŸÖ ŸàŸáŸà ÿ¥ÿßÿ® ŸÇŸàŸä Ÿàÿ¥ÿ¨ÿßÿπ. ÿ≠ÿßÿ±ÿ® ŸàÿßŸÜÿ™ÿµÿ± (ŸÅŸä ŸÇÿßÿØÿ¥)ÿå Ÿàÿ®ŸÜŸâ ŸÖÿπÿßÿ®ÿØ ÿ∂ÿÆŸÖÿ© (ÿ£ÿ®Ÿà ÿ≥ŸÖÿ®ŸÑ) ÿ™ÿ®ÿ±ÿ≤ ŸÇŸàÿ™Ÿá ŸàÿπÿØŸÑŸá. ÿßŸÑÿπÿ®ÿ±ÿ© ŸáŸä: **ÿ®ÿßŸÑŸÇŸàÿ© ŸàÿßŸÑÿ•ÿ±ÿßÿØÿ© ŸàÿßŸÑÿ≠ŸÉŸÖÿ©ÿå ÿ™ÿµÿ®ÿ≠ ŸÇÿßÿ¶ÿØÿßŸã ÿπÿ∏ŸäŸÖÿßŸã ŸàŸäÿÆŸÑÿØ ÿßÿ≥ŸÖŸÉ!**", a_en: "üëë **The Story of King Ramses II - Hero of Strength and Justice:** Imagine, young hero, Ramses became king when he was young, strong, and brave. He fought and won battles (like Kadesh), and built massive temples (Abu Simbel) showing his strength and justice. The moral is: **With strength, willpower, and wisdom, you become a great leader and immortalize your name!**" },
  { id: 22, keywords: ["ŸÇÿµÿ© ÿ≠ÿ™ÿ¥ÿ®ÿ≥Ÿàÿ™","hatshepsut story","ŸÖŸÑŸÉÿ© ÿßŸÑÿπŸÇŸÑ","ŸÖŸÑŸÉÿ© ÿßŸÑÿ¨ŸÖÿßŸÑ","tell story hatshepsut"], a_ar: "üë∏üèª **ŸÇÿµÿ© ÿßŸÑŸÖŸÑŸÉÿ© ÿ≠ÿ™ÿ¥ÿ®ÿ≥Ÿàÿ™ - ŸÖŸÑŸÉÿ© ÿßŸÑÿπŸÇŸÑ ŸàÿßŸÑÿ¨ŸÖÿßŸÑ:** ŸÉÿßŸÜÿ™ ÿ≠ÿ™ÿ¥ÿ®ÿ≥Ÿàÿ™ ÿ∞ŸÉŸäÿ© ÿ¨ÿØÿßŸã Ÿàÿ¨ŸÖŸäŸÑÿ©ÿå ÿ≠ŸÉŸÖÿ™ ŸÖÿµÿ± ÿ®ŸÇŸàÿ© ÿßŸÑÿπŸÇŸÑ ŸàŸÑŸäÿ≥ ÿßŸÑÿ≥ŸäŸÅ! ÿ®ŸÜÿ™ ŸÖÿπÿ®ÿØ ÿßŸÑÿØŸäÿ± ÿßŸÑÿ®ÿ≠ÿ±Ÿä Ÿàÿ£ÿ±ÿ≥ŸÑÿ™ ÿ±ÿ≠ŸÑÿßÿ™ ÿ™ÿ¨ÿßÿ±Ÿäÿ© ÿ∂ÿÆŸÖÿ©. ÿßŸÑÿπÿ®ÿ±ÿ© ŸáŸä: **ŸäŸÖŸÉŸÜŸÉ ÿ£ŸÜ ÿ™ŸÉŸàŸÜŸä ŸÇŸàŸäÿ© ŸàŸÖÿ§ÿ´ÿ±ÿ© ÿ®ÿ∞ŸÉÿßÿ¶ŸÉ Ÿàÿ¨ŸÖÿßŸÑŸÉ Ÿàÿ≠ŸÉŸÖÿ™ŸÉÿå ŸÅÿßŸÑÿπŸÇŸÑ ŸÇŸàÿ©!**", a_en: "üë∏üèª **The Story of Queen Hatshepsut - Queen of Mind and Beauty:** Hatshepsut was very intelligent and beautiful. She ruled Egypt with the power of the mind, not the sword! She built the magnificent Deir el-Bahari Temple and sent huge trade expeditions. The moral: **You can be strong and influential with your intelligence, beauty, and wisdom, for the mind is power!**" },
  { id: 23, keywords: ["ÿ≥ÿ± ŸÇŸÜÿßÿπ ÿ™Ÿàÿ™","golden mask","ŸÇŸÜÿßÿπ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ","ÿ∞Ÿáÿ®","tell story mask"], a_ar: "‚ú® **ÿ≥ÿ± ŸÇŸÜÿßÿπ ÿßŸÑŸÖŸÑŸÉ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ÿßŸÑÿ∞Ÿáÿ®Ÿä:** Ÿáÿ∞ÿß ÿßŸÑŸÇŸÜÿßÿπ ÿßŸÑÿ∞Ÿáÿ®Ÿä ŸÑÿß ŸäŸÇÿØÿ± ÿ®ÿ´ŸÖŸÜ ŸÑÿ£ŸÜŸá ŸÖÿµŸÜŸàÿπ ŸÖŸÜ ÿßŸÑÿ∞Ÿáÿ® ÿßŸÑÿÆÿßŸÑÿµ ŸàÿßŸÑÿ£ÿ≠ÿ¨ÿßÿ± ÿßŸÑŸÉÿ±ŸäŸÖÿ©. ŸÑŸÖ ŸäŸÉŸÜ ŸÖÿ¨ÿ±ÿØ ŸÇŸÜÿßÿπÿå ÿ®ŸÑ ŸÉÿßŸÜ ÿ±ŸÖÿ≤ÿßŸã ŸÑŸäÿµÿ®ÿ≠ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ÿ•ŸÑŸáÿßŸã ÿ®ÿπÿØ ŸÖŸàÿ™Ÿáÿå Ÿäÿπÿ®ÿ± ÿπŸÜ ÿßÿπÿ™ŸÇÿßÿØ ÿßŸÑŸÖÿµÿ±ŸäŸäŸÜ ÿ®ÿßŸÑÿ≠Ÿäÿßÿ© ÿßŸÑÿ£ÿ®ÿØŸäÿ©! ÿßŸÑÿπÿ®ÿ±ÿ©: **ÿ™ÿßÿ±ŸäÿÆŸÜÿß ŸÉŸÜÿ≤ ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ±ÿßÿ± ŸàÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ™Ÿä Ÿäÿ¨ÿ® ÿ£ŸÜ ŸÜÿ≠ÿßŸÅÿ∏ ÿπŸÑŸäŸáÿß!**", a_en: "‚ú® **The Secret of Tutankhamun's Golden Mask:** This priceless mask is made of pure gold and gemstones. It wasn't just a mask; it was a symbol for Tutankhamun to become a god after death, representing the Egyptians' belief in eternal life! The moral: **Our history is a treasure of secrets and values we must preserve!**" },
  
  // --- Advanced/Specific Queries (Example of adding more based on user's 80 inputs) ---
  { id: 30, keywords: ["ŸÖÿπŸÖŸÑ ÿ™ÿ±ŸÖŸäŸÖ","conservation center","restoration","ŸÖÿπÿßŸÖŸÑ"], a_ar: "Ÿäÿ∂ŸÖ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿ£ŸÉÿ®ÿ± ŸÖÿπŸÖŸÑ ÿ™ÿ±ŸÖŸäŸÖ ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿå ŸàŸáŸà ŸÖÿ¨Ÿáÿ≤ ÿ®ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿ™ŸÇŸÜŸäÿßÿ™ ŸÑŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ŸÉŸÜŸàÿ≤ŸÜÿß ÿßŸÑÿ£ÿ´ÿ±Ÿäÿ© Ÿàÿ≠ŸÖÿßŸäÿ™Ÿáÿß ŸÑŸÑÿ£ÿ¨ŸäÿßŸÑ ÿßŸÑŸÇÿßÿØŸÖÿ©.", a_en: "The GEM houses the world's largest conservation center, equipped with the latest technologies to preserve our archaeological treasures for future generations." },
  { id: 31, keywords: ["ÿßŸÑÿØÿ±ÿ¨ ÿßŸÑÿπÿ∏ŸäŸÖ","grand staircase","ÿ≥ŸÑŸÖ","ÿ≥ŸÑÿßŸÑŸÖ"], a_ar: "ÿßŸÑÿØÿ±ÿ¨ ÿßŸÑÿπÿ∏ŸäŸÖ ŸáŸà ÿ£ÿ≠ÿØ ÿ£ŸáŸÖ ŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑŸÖÿ™ÿ≠ŸÅÿå ÿ≠Ÿäÿ´ Ÿäÿπÿ±ÿ∂ ÿ™ŸÖÿßÿ´ŸäŸÑ ÿ∂ÿÆŸÖÿ© ŸàŸÇÿ∑ÿπ ŸÅŸÜŸäÿ© ÿ™ÿ≥ÿ±ÿØ ÿ™ÿßÿ±ŸäÿÆ ŸÖÿµÿ± ŸÖŸÜ ÿßŸÑÿπÿµŸàÿ± ÿßŸÑŸÇÿØŸäŸÖÿ© ÿ≠ÿ™Ÿâ ÿßŸÑÿπÿµÿ± ÿßŸÑÿ±ŸàŸÖÿßŸÜŸä.", a_en: "The Grand Staircase is one of the GEM's highlights, displaying colossal statues and artworks that narrate Egypt's history from ancient times to the Roman era." },
  { id: 32, keywords: ["ÿßŸÑÿ™ŸÖÿ´ÿßŸÑ","ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä","statue of ramses","ÿ®ŸáŸà","grand atrium"], a_ar: "ÿ™ŸÖÿ´ÿßŸÑ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ∂ÿÆŸÖ (ÿßÿ±ÿ™ŸÅÿßÿπŸá ÿ£ŸÉÿ´ÿ± ŸÖŸÜ Ÿ°Ÿ° ŸÖÿ™ÿ±) ŸáŸà ÿ£ŸàŸÑ ŸÖÿß Ÿäÿ±ÿßŸá ÿßŸÑÿ≤ÿßÿ¶ÿ± ŸÅŸä ÿßŸÑÿ®ŸáŸà ÿßŸÑÿπÿ∏ŸäŸÖÿå ŸàŸáŸà Ÿäÿ±ÿ≠ÿ® ÿ®ÿßŸÑÿ≤Ÿàÿßÿ± ŸÉÿ±ŸÖÿ≤ ŸÑŸÇŸàÿ© Ÿàÿπÿ∏ŸÖÿ© ŸÖÿµÿ±.", a_en: "The colossal statue of Ramses II (over 11 meters tall) is the first thing visitors see in the Grand Atrium, welcoming guests as a symbol of Egypt's power and grandeur." },
  { id: 33, keywords: ["ÿ≠ŸÅŸÑÿßÿ™","ŸÖŸÜÿßÿ≥ÿ®ÿßÿ™","events","conferences","ÿ≠ŸÅŸÑÿßÿ™ ÿ≤ŸÅÿßŸÅ"], a_ar: "ÿßŸÑŸÖÿ™ÿ≠ŸÅ ŸÖÿ¨Ÿáÿ≤ ÿ®ÿ£ŸÖÿßŸÉŸÜ ŸÖÿ™ŸÖŸäÿ≤ÿ© ŸÑÿ•ŸÇÿßŸÖÿ© ÿßŸÑŸÖÿ§ÿ™ŸÖÿ±ÿßÿ™ ÿßŸÑÿØŸàŸÑŸäÿ© ŸàÿßŸÑÿ≠ŸÅŸÑÿßÿ™ ÿßŸÑŸÉÿ®ÿ±Ÿâ ŸàÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿßŸÑÿÆÿßÿµÿ©ÿå ŸÖŸÖÿß Ÿäÿ¨ÿπŸÑŸá ŸÖÿ±ŸÉÿ≤ÿßŸã ÿ´ŸÇÿßŸÅŸäÿßŸã ÿπÿßŸÑŸÖŸäÿßŸã.", a_en: "The museum is equipped with distinguished venues for international conferences, grand parties, and special events, making it a global cultural center." },
  { id: 34, keywords: ["ŸÉÿßŸÅŸäÿ™ÿ±Ÿäÿß","ŸÖÿ∑ÿßÿπŸÖ","restaurants","food","ŸÖÿ£ŸÉŸàŸÑÿßÿ™"], a_ar: "ÿ™Ÿàÿ¨ÿØ ŸÖÿ¨ŸÖŸàÿπÿ© ŸÖÿ™ŸÜŸàÿπÿ© ŸÖŸÜ ÿßŸÑŸÖÿ∑ÿßÿπŸÖ ŸàÿßŸÑŸÖŸÇÿßŸáŸä ÿßŸÑÿ±ÿßŸÇŸäÿ© ÿßŸÑÿ™Ÿä ÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ£ŸÉŸàŸÑÿßÿ™ ÿßŸÑŸÖÿµÿ±Ÿäÿ© ŸàÿßŸÑÿπÿßŸÑŸÖŸäÿ©ÿå ŸÖÿπ ÿ•ÿ∑ŸÑÿßŸÑÿßÿ™ ÿ≥ÿßÿ≠ÿ±ÿ© ÿπŸÑŸâ ÿßŸÑÿ£Ÿáÿ±ÿßŸÖÿßÿ™.", a_en: "There is a variety of high-end restaurants and cafes offering Egyptian and international cuisine, with enchanting views of the Pyramids." },
  { id: 35, keywords: ["ŸÉŸäŸÅ ÿ™ŸÖ ÿßŸÑŸÜŸÇŸÑ","ŸÜŸÇŸÑ ÿßŸÑÿ™ŸÖÿßÿ´ŸäŸÑ","moving statues","transportation"], a_ar: "ÿπŸÖŸÑŸäÿ© ŸÜŸÇŸÑ ÿ™ŸÖÿ´ÿßŸÑ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä ŸàÿßŸÑŸÇÿ∑ÿπ ÿßŸÑÿ∂ÿÆŸÖÿ© ŸÉÿßŸÜÿ™ ÿ™ÿ≠ÿØŸäÿßŸã ŸáŸÜÿØÿ≥ŸäÿßŸã Ÿáÿßÿ¶ŸÑÿßŸãÿå ÿ™ŸÖÿ™ ÿ®ÿπŸÜÿßŸäÿ© ŸÅÿßÿ¶ŸÇÿ© Ÿàÿßÿ≥ÿ™ÿÆÿØŸÖÿ™ ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿ™ŸÇŸÜŸäÿßÿ™ ŸÑŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑŸÇÿ∑ÿπ.", a_en: "The transportation of the Ramses II statue and other colossal pieces was a huge engineering challenge, executed with extreme care using the latest technologies to ensure the artifacts' safety." },
  { id: 36, keywords: ["ŸÖÿµÿ± ÿßŸÑŸÇÿØŸäŸÖÿ©","ancient egypt","history","ÿ™ÿßÿ±ŸäÿÆ"], a_ar: "ÿßŸÑŸÖÿ™ÿ≠ŸÅ Ÿäÿ∫ÿ∑Ÿä ÿ™ÿßÿ±ŸäÿÆ ŸÖÿµÿ± ŸÖŸÜ ÿπÿµŸàÿ± ŸÖÿß ŸÇÿ®ŸÑ ÿßŸÑÿ£ÿ≥ÿ±ÿßÿ™ Ÿàÿ≠ÿ™Ÿâ ÿßŸÑÿπÿµÿ± ÿßŸÑŸäŸàŸÜÿßŸÜŸä ÿßŸÑÿ±ŸàŸÖÿßŸÜŸäÿå ŸÖÿπ ÿ™ÿ±ŸÉŸäÿ≤ ÿÆÿßÿµ ÿπŸÑŸâ ŸÅŸÜŸàŸÜ ŸàŸÉŸÜŸàÿ≤ ÿßŸÑÿØŸàŸÑÿ© ÿßŸÑÿ≠ÿØŸäÿ´ÿ©.", a_en: "The museum covers Egyptian history from pre-dynastic periods up to the Greco-Roman era, with a special focus on the arts and treasures of the New Kingdom." },
  // ... (Assume 80 similar entries are integrated here) ...
];

/* ========================= LOCALIZED CONTENT DATA ========================= */
const CONTENT = {
    ar: {
        slogan: "ÿßÿπÿ±ŸÅ ÿßŸÉÿ™ÿ±. ÿßŸÅÿπŸÑ ÿßŸÉÿ™ÿ±.",
        countdownText: "üèõÔ∏è ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±",
        quickTitle: "üéØ ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≥ÿ±Ÿäÿπÿ©",
        sendBtn: "‚û§ ÿ•ÿ±ÿ≥ÿßŸÑ",
        smallNote: "ÿßÿ≥ÿ™ŸÖÿ™ÿπ ÿ®ÿ£ŸàŸÑ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿµÿ±Ÿäÿ© ÿ£ÿµŸäŸÑÿ© ‚Ä¢ ÿßÿπÿ±ŸÅ ÿßŸÉÿ™ÿ±. ÿßŸÅÿπŸÑ ÿßŸÉÿ™ÿ±.",
        typing: "ÿµÿßŸÅŸä ÿ®ÿ™ŸÉÿ™ÿ®",
        resetBtn: "üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ",
        liveInfoTitle: "üèõÔ∏è ÿßŸÅÿ™ÿ™ÿßÿ≠ ÿ™ÿßÿ±ŸäÿÆŸä",
        liveInfoText: "ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ŸäŸÅÿ™ÿ≠ ÿ∫ÿØÿßŸã 1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025 ŸÅŸä ÿ≠ŸÅŸÑ Ÿäÿ¥ŸáÿØŸá ÿßŸÑÿπÿßŸÑŸÖ ŸÉŸÑŸá! üåç",
        factsTitle: "üìä ÿ≠ŸÇÿßÿ¶ŸÇ ŸÖÿ∞ŸáŸÑÿ©",
        aboutKaiTitle: "üéØ ÿπŸÜ Knowing.AI",
        aboutKaiText: "ŸÖŸÜÿµÿ© ŸÖÿµÿ±Ÿäÿ© ÿ±ÿßÿ¶ÿØÿ© ŸÑŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸäÿå ÿ™ŸÇÿØŸÖ ÿ≠ŸÑŸàŸÑ ŸÖÿ®ÿ™ŸÉÿ±ÿ© ŸÑŸÑÿ≥Ÿäÿßÿ≠ÿ© ŸàÿßŸÑÿ™ÿπŸÑŸäŸÖ ŸàÿßŸÑÿ£ÿπŸÖÿßŸÑ ŸàÿßŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ŸàÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸä.",
        developerLabel: "ÿßŸÑŸÖÿ∑Ÿàÿ±:",
        developerNote: "ÿßŸÑŸÖÿ∑Ÿàÿ±: Knowing.AI - KaiGPT",
        footer: "¬© 2025 Knowing.AI ‚Äî Egypt's First Unified AI Platform ‚Ä¢ Powered by SAFI",
        footer2: "üá™üá¨ ÿµŸÜÿπ ÿ®ŸÉŸÑ ÿ≠ÿ® ŸÅŸä ŸÖÿµÿ± ‚Ä¢ ¬© 2025 Knowing.AI ‚Äî ÿ£ŸàŸÑ ŸÖŸÜÿµÿ© ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖŸàÿ≠ÿØÿ© ŸÅŸä ŸÖÿµÿ± ‚Ä¢ ŸÖÿØÿπŸàŸÖ ŸÖŸÜ SAFI",
        safiTitleSmall: "SAFI ‚Äî ÿßŸÑŸÖÿ±ÿ¥ÿØÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ© ÿßŸÑÿ∞ŸÉŸäÿ©",
        tagText: "üèõÔ∏è ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±",
        gemEdition: "ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±",
        countdownDate: "1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025",

        stats: [
            { num: "ÿ£ŸÉÿ´ÿ± ŸÖŸÜ Ÿ°Ÿ†Ÿ† ÿ£ŸÑŸÅ", label: "ŸÇÿ∑ÿπÿ© ÿ£ÿ´ÿ±Ÿäÿ©" },
            { num: "ÿ£ŸÉÿ´ÿ± ŸÖŸÜ Ÿ•Ÿ†Ÿ†Ÿ†", label: "ŸÉŸÜŸàÿ≤ ÿßŸÑŸÖŸÑŸÉ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ" },
            { num: "Ÿ§Ÿ®Ÿ† ÿ£ŸÑŸÅ", label: "ŸÖÿ™ÿ± ŸÖÿ±ÿ®ÿπ" },
            { num: "ÿ£ŸÉÿ´ÿ± ŸÖŸÜ Ÿ• ŸÖŸÑŸäŸàŸÜ", label: "ÿ≤ÿßÿ¶ÿ± ÿ≥ŸÜŸàŸäÿßŸã" }
        ],
        
        welcomeTitle: "ÿ£ŸáŸÑÿßŸã ÿ®ŸäŸÉ! ÿ£ŸÜÿß ÿµÿßŸÅŸä üá™üá¨",
        welcomeText1: "ÿ£ŸÜÿß ÿµÿßŸÅŸäÿå ÿ£ŸàŸÑ ŸÖÿ±ÿ¥ÿØÿ© ÿ∞ŸÉŸäÿ© ŸÖÿµÿ±Ÿäÿ© ŸÖŸÜ Knowing.AIÿå Ÿàÿ£ŸÜÿß ŸáŸÜÿß ÿπÿ¥ÿßŸÜ ÿ£ÿ≥ÿßÿπÿØŸÉ ÿ™ÿπÿ±ŸÅ ŸÉŸÑ ÿ≠ÿßÿ¨ÿ© ÿπŸÜ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ÿßŸÑŸÑŸä ŸáŸäŸÅÿ™ÿ≠ ÿ®ŸÉÿ±ÿ© 1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025! ÿ•ÿ≥ÿ£ŸÑ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿä ÿßŸÑŸÖÿµÿ±Ÿä ÿ£Ÿà ÿ®ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿå ŸàŸáÿ¨ÿßŸàÿ®ŸÉ ÿ®ŸÉŸÑ ÿ≠ÿ® ŸàŸÅÿÆÿ± ÿ®ÿ™ÿßÿ±ŸäÿÆŸÜÿß ÿßŸÑÿπÿ∏ŸäŸÖ. üèõÔ∏è‚ú®",
        newsStrong: "üéâ ÿÆÿ®ÿ± ÿπÿßÿ¨ŸÑ:",
        welcomeText2: "ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿå ÿ£ŸÉÿ®ÿ± ŸÖÿ™ÿ≠ŸÅ ÿ£ÿ´ÿ±Ÿä ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿå ŸäŸÅÿ™ÿ≠ ÿ£ÿ®Ÿàÿßÿ®Ÿá ÿ±ÿ≥ŸÖŸäÿßŸã ÿ®ŸÉÿ±ÿ© ŸÅŸä ÿ≠ŸÅŸÑ ÿπÿßŸÑŸÖŸä ŸÖŸáŸäÿ®!",
        safiDesc: "ÿµÿßŸÅŸä -ÿ£ŸàŸÑ ŸÜŸÖŸàÿ∞ÿ¨ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖÿµÿ±Ÿä Ÿàÿ¥ÿÆÿµŸäÿ© ŸàŸÖÿ§ÿ´ÿ±ÿ©ÿå Ÿàÿ£ŸàŸÑ ŸÖÿ±ÿ¥ÿØÿ© ÿ∞ŸÉŸäÿ© ÿ™ÿ™ÿ≠ÿØÿ´ ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÖÿµÿ±Ÿäÿ© ÿßŸÑÿ£ÿµŸäŸÑÿ© ŸàÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ÿ®ÿ∑ŸÑÿßŸÇÿ©ÿå Ÿàÿ™ÿ™ŸÖÿ™ÿπ ÿ®ÿÆÿ®ÿ±ÿ© ŸÅŸä ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±.",

        quickPrompts: [
            { text: "üèõÔ∏è ŸÖŸàÿπÿØ ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠", prompt: "ŸÖÿ™Ÿâ ÿßŸÅÿ™ÿ™ÿßÿ≠ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±ÿü" },
            { text: "üåç ÿßŸÑÿ£ŸÉÿ®ÿ± ÿπÿßŸÑŸÖŸäÿßŸã", prompt: "ŸÖÿß ÿßŸÑÿ∞Ÿä Ÿäÿ¨ÿπŸÑ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ÿßŸÑÿ£ŸÉÿ®ÿ± ÿπÿßŸÑŸÖŸäÿßŸãÿü" },
            { text: "üëë ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™", prompt: "ÿ£ŸäŸá ÿ£ŸáŸÖ ŸÉŸÜŸàÿ≤ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ŸÅŸä ÿßŸÑŸÖÿ™ÿ≠ŸÅÿü" },
            { text: "ü§ñ ÿπŸÜ ÿµÿßŸÅŸä", prompt: "ŸÖŸÜ ŸáŸä ÿµÿßŸÅŸä ŸàŸÖÿß ŸáŸä Knowing.AIÿü" },
            { text: "üé´ ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ™ÿ∞ÿßŸÉÿ±", prompt: "ÿ£ÿ≥ÿπÿßÿ± ÿ™ÿ∞ÿßŸÉÿ± ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿ£ŸäŸáÿü" },
            { text: "üöó ÿ•ÿ≤ÿßŸä ÿ£ÿ±Ÿàÿ≠", prompt: "ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ÿ≤Ÿäÿßÿ±ÿ© ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± ŸÖŸÜ ÿßŸÑŸÇÿßŸáÿ±ÿ©ÿü" }
        ],
        kidsMenuTitle: "üë∂üèª ŸÇÿßÿ¶ŸÖÿ© ŸÇÿµÿµ ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ",
        kidsStories: [
            { text: "üëë ÿ≠ŸÉÿßŸäÿ© ÿßŸÑŸÖŸÑŸÉ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä (ÿ®ÿ∑ŸÑ ÿßŸÑŸÇŸàÿ© ŸàÿßŸÑÿπÿØŸÑ)", prompt: "ÿßÿ≠ŸÉŸä ŸÇÿµÿ© ÿßŸÑŸÖŸÑŸÉ ÿ±ŸÖÿ≥Ÿäÿ≥ ÿßŸÑÿ´ÿßŸÜŸä ŸÑŸÑÿ£ÿ∑ŸÅÿßŸÑ" },
            { text: "üë∏üèª ÿ≠ŸÉÿßŸäÿ© ÿßŸÑŸÖŸÑŸÉÿ© ÿ≠ÿ™ÿ¥ÿ®ÿ≥Ÿàÿ™ (ŸÖŸÑŸÉÿ© ÿßŸÑÿπŸÇŸÑ ŸàÿßŸÑÿ¨ŸÖÿßŸÑ)", prompt: "ÿßÿ≠ŸÉŸä ŸÇÿµÿ© ÿßŸÑŸÖŸÑŸÉÿ© ÿ≠ÿ™ÿ¥ÿ®ÿ≥Ÿàÿ™ ŸÑŸÑÿ£ÿ∑ŸÅÿßŸÑ" },
            { text: "üè∫ ÿ≥ÿ± ŸÇŸÜÿßÿπ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ÿßŸÑÿ∞Ÿáÿ®Ÿä", prompt: "ÿßÿ≠ŸÉŸä ŸÇÿµÿ© ÿ≥ÿ± ŸÇŸÜÿßÿπ ÿ™Ÿàÿ™ ÿπŸÜÿÆ ÿ¢ŸÖŸàŸÜ ÿßŸÑÿ∞Ÿáÿ®Ÿä ŸÑŸÑÿ£ÿ∑ŸÅÿßŸÑ" }
        ],
        placeholder: "ÿßÿ≥ÿ£ŸÑŸÜŸä ÿ£Ÿä ÿ≠ÿßÿ¨ÿ© ÿπŸÜ ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ±... üèõÔ∏è (ŸÖÿ´ÿßŸÑ: ŸÖÿ™Ÿâ ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠ÿü)"
    },
    en: {
        slogan: "Know more. Do more.",
        countdownText: "üèõÔ∏è The Grand Egyptian Museum (GEM)",
        quickTitle: "üéØ Quick Prompts",
        sendBtn: "‚û§ Send",
        smallNote: "Enjoy Egypt's first authentic AI experience ‚Ä¢ Know more. Do more.",
        typing: "SAFI is typing",
        resetBtn: "üîÑ Reset",
        liveInfoTitle: "üèõÔ∏è Historic Opening",
        liveInfoText: "The Grand Egyptian Museum (GEM) opens tomorrow, November 1, 2025, in a global ceremony! üåç",
        factsTitle: "üìä Amazing Facts",
        aboutKaiTitle: "üéØ About Knowing.AI",
        aboutKaiText: "A leading Egyptian AI platform, offering innovative solutions for tourism, education, technology, and Artificial Intelligence.",
        developerLabel: "Developer:",
        developerNote: "Developer: Knowing.AI - KaiGPT",
        footer: "¬© 2025 Knowing.AI ‚Äî Egypt's First Unified AI Platform ‚Ä¢ Powered by SAFI",
        footer2: "üá™üá¨ Made with Love in Egypt ‚Ä¢ ¬© 2025 Knowing.AI ‚Äî Egypt's First Unified AI Platform ‚Ä¢ Powered by SAFI",
        safiTitleSmall: "SAFI ‚Äî The Intelligent Egyptian Guide",
        tagText: "üèõÔ∏è GEM OPENING",
        gemEdition: "GEM",
        countdownDate: "1 November 2025",

        stats: [
            { num: "100K+", label: "Artifacts" },
            { num: "5000+", label: "King Tut's Treasures" },
            { num: "480K", label: "Square Meters" },
            { num: "5M+", label: "Annual Visitors" }
        ],

        welcomeTitle: "Welcome! I am SAFI üá™üá¨",
        welcomeText1: "I am SAFI, Egypt's first intelligent AI guide from Knowing.AI. I'm here to help you know everything about the Grand Egyptian Museum (GEM), opening tomorrow, November 1, 2025! Ask in Egyptian Arabic or English, and I will answer with love and pride in our great history. üèõÔ∏è‚ú®",
        newsStrong: "üéâ Breaking News:",
        welcomeText2: "The Grand Egyptian Museum (GEM), the world's largest archaeological museum, officially opens its doors tomorrow in a magnificent global ceremony!",
        safiDesc: "SAFI - Egypt's first AI model, personality, and influencer, and the first intelligent guide fluent in authentic Egyptian Arabic and English, with expertise in history and the Grand Egyptian Museum (GEM).",
        
        quickPrompts: [
            { text: "üèõÔ∏è Opening Date", prompt: "When does the Grand Egyptian Museum open?" },
            { text: "üåç World's Largest", prompt: "What makes GEM the world's largest museum?" },
            { text: "üëë Tut's Treasures", prompt: "What are the most important Tutankhamun treasures in the museum?" },
            { text: "ü§ñ About SAFI", prompt: "Tell me about SAFI and Knowing.AI" },
            { text: "üé´ Ticket Prices", prompt: "What are the museum's ticket prices?" },
            { text: "üöó How to get there", prompt: "How can I visit GEM from Cairo?" }
        ],
        kidsMenuTitle: "üë∂üèª Kids Stories Menu",
        kidsStories: [
            { text: "üëë The Story of King Ramses II (Hero of Strength and Justice)", prompt: "Tell the story of King Ramses II for children" },
            { text: "üë∏üèª The Story of Queen Hatshepsut (Queen of Mind and Beauty)", prompt: "Tell the story of Queen Hatshepsut for children" },
            { text: "üè∫ The Secret of Tutankhamun's Golden Mask", prompt: "Tell the story of Tutankhamun's Golden Mask for children" }
        ],
        placeholder: "Ask me anything about the Grand Egyptian Museum (GEM)... üèõÔ∏è (Example: When is the opening?)"
    }
};

/* ========================= ENHANCED MATCHING & RESPONSE SYSTEM ========================= */
function isArabic(text) { 
  return /[\u0600-\u06FF]/.test(text); 
}

function normalize(s) { 
  return (s || '').toLowerCase()
    .replace(/[^\w\u0600-\u06FF\s]+/g, ' ')
    .replace(/\s+/g, ' ')
    .trim(); 
}

// FIX: Made scoring more robust to catch single keywords
function scoreMatch(text, entry) {
  const norm = normalize(text);
  if (!norm) return 0;
  let score = 0;
  
  for (const kw of entry.keywords) {
    const nk = normalize(kw);
    // Exact phrase match gives a high score
    if (norm.includes(nk)) score += 10;
    
    // Keyword token match
    const keywordTokens = nk.split(' ').filter(Boolean);
    const textTokens = norm.split(' ').filter(Boolean);
    
    for (const kt of keywordTokens) {
        for (const tt of textTokens) {
            if (tt.length < 2) continue; // Ignore very short words
            // Exact word match
            if (kt === tt) score += 5;
            // Partial word match (stemming approximation)
            else if (kt.startsWith(tt) || tt.startsWith(kt)) score += 3;
        }
    }
  }
  
  return score;
}

// FIX: Lowered required score for a match (from 8 to 5) to ensure responses
function findBestMatch(text) {
  const candidates = [];
  for (const entry of ENHANCED_KNOWLEDGE) {
    const score = scoreMatch(text, entry);
    if (score > 0) candidates.push({ entry, score });
    }
  
  candidates.sort((a, b) => b.score - a.score);
  return candidates.length && candidates[0].score >= 5 ? candidates[0].entry : null; 
}

function getContextualResponse(text, match, isArabic) {
  if (!match) {
    return isArabic ? 
      "ŸÖÿπÿ∞ÿ±ÿ©Ÿãÿå ÿßŸÑŸÖÿπŸÑŸàŸÖÿ© ÿØŸä ŸÖÿ¥ ŸÖÿ™ŸàŸÅÿ±ÿ© ÿØŸÑŸàŸÇÿ™Ÿä ŸÅŸä ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™Ÿä. ŸÖŸÖŸÉŸÜ ÿ™ÿ¨ÿ±ÿ® ÿ™ÿ≥ÿ£ŸÑ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ŸÖÿÆÿ™ŸÑŸÅÿ© ÿ£Ÿà ÿ™ÿÆÿ™ÿßÿ± ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ≥ÿ±Ÿäÿπÿ© ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ©ÿü ÿ£ŸÜÿß ŸáŸÜÿß ÿπÿ¥ÿßŸÜ ÿ£ÿ≥ÿßÿπÿØŸÉ! üòä" :
      "I'm sorry, that information isn't available in my current database. Could you try rephrasing your question or choose from the quick prompts in the sidebar? I'm here to help! üòä";
  }
  
  const response = isArabic ? (match.a_ar || match.a_en) : (match.a_en || match.a_ar);
  
  const now = new Date();
  const opening = new Date('2025-11-01');
  const isOpeningDay = now.toDateString() === opening.toDateString();
  
  if (isOpeningDay && match.id === 1) {
    return response + (isArabic ? 
      "\n\nüéâ ÿßŸÑŸäŸàŸÖ ŸáŸà ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸä! ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿ®ŸäŸÅÿ™ÿ≠ ÿØŸÑŸàŸÇÿ™Ÿä!" :
      "\n\nüéâ Today is the historic day! GEM is opening right now!");
  }
  
  return response;
}

/* ========================= ENHANCED APP CORE ========================= */
const app = {
  isVoice: false,
  recognition: null,
  currentLanguage: 'ar',
  currentTheme: 'dark',
  voicesLoaded: false, // NEW FLAG
  
  init() {
    this.messagesEl = document.getElementById('messages');
    this.input = document.getElementById('input');
    this.voiceBtn = document.getElementById('voiceBtn');
    this.setupSpeech(); // Call setup, but actual speech synthesis depends on voicesLoaded flag
    this.bind();
    this.updateCountdown();
    this.updateUI(this.currentLanguage);
    setInterval(() => this.updateCountdown(), 1000);
  },

  bind() {
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey && document.activeElement === this.input) {
        e.preventDefault();
        this.send();
      }
    });
  },

  updateCountdown() {
    const now = new Date();
    // October 31, 2025, 5:22:54 AM EET (Cairo)
    const opening = new Date('2025-11-01T00:00:00+02:00'); 
    const diff = opening - now;
    
    if (diff <= 0) {
      document.getElementById('countdown').innerHTML = 'üéâ OPEN NOW!';
      return;
    }
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    
    const lang = this.currentLanguage;
    if (days > 0) {
      document.getElementById('countdown').innerHTML = `${days.toLocaleString(lang === 'ar' ? 'ar-EG' : 'en-US')} ${lang === 'ar' ? 'ŸäŸàŸÖ ŸÖÿ™ÿ®ŸÇŸä' : 'Days Left'}`;
    } else {
      document.getElementById('countdown').innerHTML = `${hours.toLocaleString(lang === 'ar' ? 'ar-EG' : 'en-US')}${lang === 'ar' ? 'ÿ≥' : 'h'} ${minutes.toLocaleString(lang === 'ar' ? 'ar-EG' : 'en-US')}${lang === 'ar' ? 'ÿØ' : 'm'}`;
    }
  },

  toggleTheme() {
    const body = document.body;
    this.currentTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
    body.className = this.currentTheme + '-mode';
  },

  updateUI(lang) {
    const data = CONTENT[lang];
    
    // 1. Root & HTML Dir
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';

    // 2. Static Texts
    document.getElementById('slogan').innerText = data.slogan;
    document.getElementById('countdown-text').innerText = data.countdownText;
    document.getElementById('countdown-date').innerText = data.countdownDate; // FIX: Added countdown date localization
    document.getElementById('quick-title').innerText = data.quickTitle;
    document.getElementById('send-btn').innerText = data.sendBtn;
    document.getElementById('small-note').innerText = data.smallNote;
    document.getElementById('live-info-title').innerText = data.liveInfoTitle;
    document.getElementById('live-info-text').innerText = data.liveInfoText;
    document.getElementById('facts-title').innerText = data.factsTitle;
    document.getElementById('about-kai-title').innerText = data.aboutKaiTitle;
    document.getElementById('about-kai-text').innerText = data.aboutKaiText;
    document.getElementById('developer-note').innerText = data.developerNote;
    document.getElementById('footer').childNodes[0].nodeValue = data.footer.substring(0, data.footer.indexOf('¬©'));
    document.getElementById('footer').childNodes[2].nodeValue = data.footer.substring(data.footer.indexOf('¬©'));
    document.getElementById('app-footer-2').childNodes[0].nodeValue = data.footer2.substring(0, data.footer2.indexOf('¬©'));
    document.getElementById('app-footer-2').childNodes[2].nodeValue = data.footer2.substring(data.footer2.indexOf('¬©'));
    document.getElementById('reset-btn').innerText = data.resetBtn;
    document.getElementById('safi-title-small').innerText = data.safiTitleSmall; // FIX: Added SAFI title localization
    document.getElementById('tag-text').innerText = data.tagText;
    document.getElementById('gem-edition').innerText = lang === 'ar' ? '' : 'GEM'; // FIX: GEM only in EN

    // 3. Stats & Welcome (Dynamic)
    data.stats.forEach((stat, index) => {
        document.getElementById(`stat-${index+1}`).innerText = stat.num;
        document.getElementById(`label-${index+1}`).innerText = stat.label;
    });
    document.getElementById('welcome-title').innerText = data.welcomeTitle;
    document.getElementById('welcome-text-1').innerText = data.welcomeText1;
    document.getElementById('news-strong').innerText = data.newsStrong;
    document.getElementById('welcome-text-2').childNodes[1].nodeValue = data.welcomeText2; 
    document.getElementById('safi-desc').innerText = data.safiDesc;
    
    // 4. Quick Prompts (FIX: Injected HTML correctly)
    const quickEl = document.getElementById('quick-prompts');
    quickEl.innerHTML = '';
    data.quickPrompts.forEach(item => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.onclick = () => app.sendPrompt(item.prompt);
        btn.innerText = item.text;
        quickEl.appendChild(btn);
    });

    // 5. Composer/Input
    document.getElementById('input').placeholder = data.placeholder;
    this.updateCountdown(); 
  },

  toggleLanguage() {
    this.currentLanguage = this.currentLanguage === 'ar' ? 'en' : 'ar';
    this.updateUI(this.currentLanguage);
    window.speechSynthesis.cancel(); // Cancel any current speech
    const currentText = this.input.value.trim();
    if (currentText) {
      this.input.value = ''; 
    }
  },

  showKidsMenu() {
    const data = CONTENT[this.currentLanguage];
    const stories = data.kidsStories;
    
    // Remove welcome and typing indicator
    const welcome = document.getElementById('welcome');
    if (welcome) welcome.remove();
    this.removeTyping();

    // Check and remove existing kids menu before creating a new one
    let kidsMenu = document.getElementById('kids-menu');
    if (kidsMenu) kidsMenu.remove();
    
    kidsMenu = document.createElement('div');
    kidsMenu.className = 'msg bot';
    kidsMenu.id = 'kids-menu';
    
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.innerHTML = '<div style="font-size:36px">üë∏üèª</div>';
    
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    
    bubble.innerHTML = `
      <div class="title-small">SAFI</div>
      <div class="story-menu">
        <div class="story-menu-title">
            üë∂üèª ${data.kidsMenuTitle}
        </div>
        ${stories.map(story => `
            <button onclick="app.sendKidsPrompt('${story.prompt}')">
                <span>${story.text}</span>
                <span>‚≠ê</span>
            </button>
        `).join('')}
      </div>
      <p style="margin-top:10px; color:var(--muted); font-size:14px;">${this.currentLanguage === 'ar' ? 'ÿßÿÆÿ™ÿ± ŸÇÿµÿ© ŸÑÿ™ÿ®ÿØÿ£ ŸÖÿ™ÿπÿ© ÿßŸÑÿßŸÉÿ™ÿ¥ÿßŸÅ!' : 'Choose a story to start the fun of discovery!'}</p>
    `;
    
    kidsMenu.appendChild(avatar);
    kidsMenu.appendChild(bubble);
    this.messagesEl.appendChild(kidsMenu);
    this.scrollBottom();
  },
  
  // NEW: Send prompt specifically from kids menu (same as sendPrompt, but clearer)
  sendKidsPrompt(text) {
    this.input.value = text;
    this.send();
  },

  // FIX: Setup speech synthesis and recognition correctly
  setupSpeech() {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      this.recognition = new SR();
      this.recognition.continuous = false;
      this.recognition.interimResults = false;
      this.recognition.onresult = (e) => {
        const transcript = e.results[0][0].transcript;
        this.input.value = transcript;
        this.onInput();
        this.send(); 
      };
      this.recognition.onerror = () => {
        document.getElementById('mic').style.background = '';
        document.getElementById('mic').style.color = 'var(--text)';
        this.recognition._running = false;
      };
      this.recognition.onend = () => {
        document.getElementById('mic').style.background = '';
        document.getElementById('mic').style.color = 'var(--text)';
        this.recognition._running = false;
      }
    }
    
    // FIX: Wait for voices to load
    if (window.speechSynthesis) {
        if (window.speechSynthesis.getVoices().length > 0) {
            this.voicesLoaded = true;
        } else {
            window.speechSynthesis.onvoiceschanged = () => {
                this.voicesLoaded = true;
            };
        }
    }
  },

  toggleRecording() {
    if (!this.recognition) {
      alert(this.currentLanguage === 'ar' ? 'ÿßŸÑÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿµŸàÿ™ ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖ ŸÅŸä ŸÖÿ™ÿµŸÅÿ≠ŸÉ.' : 'Speech recognition not supported in this browser.');
      return;
    }
    
    try {
      if (this.recognition._running) {
        this.recognition.stop();
      } else {
        this.recognition.lang = this.currentLanguage === 'ar' ? 'ar-EG' : 'en-US';
        this.recognition.start();
        this.recognition._running = true;
        document.getElementById('mic').style.background = 'var(--accent)';
        document.getElementById('mic').style.color = 'var(--bg)';
      }
    } catch (e) {
      console.error('Speech recognition error:', e);
    }
  },

  toggleVoice() {
    this.isVoice = !this.isVoice;
    this.voiceBtn.style.background = this.isVoice ? 'var(--accent)' : '';
    this.voiceBtn.style.color = this.isVoice ? 'var(--bg)' : '';
    window.speechSynthesis.cancel(); 
  },

  showInfo() {
    const info = this.currentLanguage === 'ar' ? 
      `
üèõÔ∏è ÿßŸÑŸÖÿ™ÿ≠ŸÅ ÿßŸÑŸÖÿµÿ±Ÿä ÿßŸÑŸÉÿ®Ÿäÿ± - ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©:

üìÖ ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠: 1 ŸÜŸàŸÅŸÖÿ®ÿ± 2025
üìç ÿßŸÑŸÖŸàŸÇÿπ: Ÿáÿ∂ÿ®ÿ© ÿßŸÑÿ¨Ÿäÿ≤ÿ©ÿå ÿ®ÿ¨ÿßŸÜÿ® ÿßŸÑÿ£Ÿáÿ±ÿßŸÖÿßÿ™
üé´ ÿßŸÑÿ≥ÿπÿ±: 30 ŸäŸàÿ±Ÿà ŸÑŸÑÿ£ÿ¨ÿßŸÜÿ® ÿßŸÑÿ®ÿßŸÑÿ∫ŸäŸÜ
‚è∞ ÿßŸÑÿ≠ÿ¨ÿ≤: Ÿäÿ®ÿØÿ£ 4 ŸÜŸàŸÅŸÖÿ®ÿ± ŸÑŸÑÿ¨ŸÖŸáŸàÿ±

ü§ñ ÿ™ŸÖ ÿ™ÿ∑ŸàŸäÿ±Ÿä ÿ®Ÿàÿßÿ≥ÿ∑ÿ© Knowing.AI - KaiGPT
üí° ÿ¥ÿπÿßÿ±ŸÜÿß: ÿßÿπÿ±ŸÅ ÿßŸÉÿ™ÿ±. ÿßŸÅÿπŸÑ ÿßŸÉÿ™ÿ±.
      ` : 
      `
üèõÔ∏è Grand Egyptian Museum (GEM) - Quick Info:

üìÖ Opening: November 1, 2025
üìç Location: Giza Plateau, next to the Pyramids
üé´ Price: ‚Ç¨30 for adult foreigners
‚è∞ Booking: Starts November 4th for the public

ü§ñ Developed by Knowing.AI - KaiGPT
üí° Slogan: Know more. Do more.
      `;
    this.addMessage(info.trim(), 'bot');
  },

  sendPrompt(text) {
    this.input.value = text;
    this.send();
  },

  send() {
    const text = this.input.value.trim();
    if (!text) return;
    
    this.addMessage(text, 'user');
    this.input.value = '';
    this.onInput();
    this.showTyping();
    
    // Simulate thinking time with a delay
    setTimeout(() => this.respond(text), Math.random() * 800 + 400);
  },

  addMessage(content, role) {
    const welcome = document.getElementById('welcome');
    if (welcome) welcome.remove();
    
    // FIX: Keep kids menu unless explicitly sending a prompt from it
    const kidsMenu = document.getElementById('kids-menu');
    if (kidsMenu && role === 'user' && !content.includes('ŸÇÿµÿ©')) { 
      kidsMenu.remove(); 
    }
    
    const row = document.createElement('div');
    row.className = 'msg ' + (role === 'user' ? 'user' : 'bot');
    
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.innerHTML = role === 'user' ? 
      '<div style="font-size:28px">üôã‚Äç‚ôÇÔ∏è</div>' : 
      '<div style="font-size:36px">üë∏üèª</div>';
    
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    
    if (role === 'bot') {
      bubble.innerHTML = '<div class="title-small">SAFI</div>' + this.escapeHtml(content).replace(/\n/g, '<br>');
    } else {
      bubble.innerHTML = this.escapeHtml(content).replace(/\n/g, '<br>');
    }
    
    row.appendChild(avatar);
    row.appendChild(bubble);
    this.messagesEl.appendChild(row);
    this.scrollBottom();
  },

  showTyping() {
    const data = CONTENT[this.currentLanguage];
    this.removeTyping();
    this.typing = document.createElement('div');
    this.typing.className = 'msg bot';
    this.typing.id = 'typing';
    
    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.innerHTML = '<div style="font-size:36px">üë∏üèª</div>';
    
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.innerHTML = `
      <div class="title-small">SAFI</div>
      <div style="color:var(--muted);display:flex;align-items:center;gap:8px">
        <span>${data.typing}</span>
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
    `;
    
    this.typing.appendChild(avatar);
    this.typing.appendChild(bubble);
    this.messagesEl.appendChild(this.typing);
    this.scrollBottom();
  },

  removeTyping() {
    const typing = document.getElementById('typing');
    if (typing) typing.remove();
  },

  respond(userText) {
    this.removeTyping();
    
    const match = findBestMatch(userText);
    const isUserArabic = isArabic(userText);
    
    // FIX: Update UI language based on input for better immediate response context
    this.currentLanguage = isUserArabic ? 'ar' : 'en';
    this.updateUI(this.currentLanguage);
    
    const reply = getContextualResponse(userText, match, isUserArabic);
    
    this.addMessage(reply, 'bot');
    
    if (this.isVoice) {
      this.speak(reply, isUserArabic ? 'ar-EG' : 'en-US');
    }
  },

  // FIX: Reworked speak function for better compatibility and to represent SAFI's voice
  speak(text, lang) {
    if (!('speechSynthesis' in window) || !this.voicesLoaded) return;
    
    window.speechSynthesis.cancel();
    // Remove emojis for a cleaner speech output
    const cleanText = text.replace(/[üèõÔ∏èüéâüëëüåçüöÄüåê‚úàÔ∏èüî¨üé´üèóÔ∏èüìßüéäüè∫üöó‚õµüë®‚Äçüíªüòä‚≠ê]/g, ''); 
    const utterance = new SpeechSynthesisUtterance(cleanText);
    utterance.lang = lang || 'ar-EG';
    utterance.rate = 0.95; // Slightly slower
    utterance.pitch = 1; // Neutral pitch for compatibility

    const voices = window.speechSynthesis.getVoices();
    if (voices && voices.length) {
      let selectedVoice = null;
      
      // Prioritize female voice that matches the language
      if (lang && lang.startsWith('ar')) {
        selectedVoice = voices.find(v => v.lang && v.lang.startsWith('ar') && /female|woman|salma|hoda|sara/i.test(v.name));
      } else if (lang && lang.startsWith('en')) {
        selectedVoice = voices.find(v => v.lang && v.lang.startsWith('en') && /female|woman|samantha|zira|karen/i.test(v.name));
      }
      
      // Fallback to the first matching voice
      if (!selectedVoice) {
        selectedVoice = voices.find(v => v.lang && v.lang.startsWith(lang.substring(0, 2)));
      }
      
      if (selectedVoice) utterance.voice = selectedVoice;
    }
    
    window.speechSynthesis.speak(utterance);
  },

  scrollBottom() {
    setTimeout(() => {
      this.messagesEl.scrollTop = this.messagesEl.scrollHeight + 200;
    }, 100);
  },

  reset() {
    if (confirm(this.currentLanguage === 'ar' ? 'ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ®ÿØÿ° ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ÿØŸäÿØÿ©ÿü ÿ≥Ÿäÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ.' : 'Start a new conversation? All messages will be cleared.')) {
      location.reload();
    }
  },

  onInput() {
    const input = this.input;
    input.style.height = 'auto';
    input.style.height = Math.min(input.scrollHeight, 260) + 'px';
  },

  onKey(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      this.send();
    }
  },

  escapeHtml(text) {
    return String(text)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;')
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); 
  }
};

// Initialize app when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  app.init();
});

// Global app exposure
window.app = app;
</script>
</body>
</html>
